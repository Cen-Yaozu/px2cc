{"version":3,"sources":["../../../node_modules/.pnpm/tsup@8.5.0_jiti@2.5.1_postcss@8.5.6_tsx@4.20.5_typescript@5.9.2_yaml@2.8.1/node_modules/tsup/assets/cjs_shims.js","../src/toolx/SandboxIsolationManager.js","../src/toolx/SandboxErrorManager.js","../src/toolx/ToolDirectoryManager.js","../src/toolx/ESModuleRequireSupport.js","../src/utils/ServerEnvironment.js","../src/utils/ProjectManager.js","../src/utils/ProjectPathResolver.js","../src/toolx/ToolSandbox.js","../src/toolx/ToolInterface.js","../src/toolx/ToolValidator.js","../src/toolx/ToolUtils.js","../src/toolx/index.js"],"sourcesContent":["// Shim globals in cjs bundle\n// There's a weird bug that esbuild will always inject importMetaUrl\n// if we export it as `const importMetaUrl = ... __filename ...`\n// But using a function will not cause this issue\n\nconst getImportMetaUrl = () =>\n  typeof document === 'undefined'\n    ? new URL(`file:${__filename}`).href\n    : (document.currentScript && document.currentScript.src) ||\n      new URL('main.js', document.baseURI).href\n\nexport const importMetaUrl = /* @__PURE__ */ getImportMetaUrl()\n","const path = require('path');\nconst Module = require('module');\nconst logger = require('@promptx/logger');\n\n/**\n * SandboxIsolationManager - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰æ²™ç®±éš”ç¦»é€»è¾‘\n * \n * èŒè´£ï¼š\n * - åˆ›å»ºå®Œå…¨éš”ç¦»çš„VMæ²™ç®±ç¯å¢ƒ\n * - ç»Ÿä¸€ç®¡ç†æ¨¡å—ç³»ç»Ÿã€è¿›ç¨‹ç¯å¢ƒã€å…¨å±€å¯¹è±¡çš„éš”ç¦»\n * - æä¾›å®‰å…¨ã€ä¸€è‡´çš„æ²™ç®±æ‰§è¡Œä¸Šä¸‹æ–‡\n */\nclass SandboxIsolationManager {\n  constructor(workingPath, options = {}) {\n    this.workingPath = workingPath;  // å·¥ä½œç›®å½•ï¼ˆ~/.promptxï¼‰\n    this.toolboxPath = options.toolboxPath || workingPath;  // å·¥å…·ç®±ç›®å½•ï¼ˆç”¨äºä¾èµ–åŠ è½½ï¼‰\n    this.sandboxPath = workingPath;  // å‘åå…¼å®¹\n    this.options = {\n      enableDependencyLoading: true,\n      enableBuiltinModules: true,\n      enableFileSystemAccess: false,\n      ...options\n    };\n    this.isolatedContext = null;\n  }\n\n  /**\n   * åˆ›å»ºå®Œå…¨éš”ç¦»çš„æ²™ç®±ç¯å¢ƒ\n   * @returns {Object} éš”ç¦»çš„æ²™ç®±ä¸Šä¸‹æ–‡\n   */\n  createIsolatedContext() {\n    if (this.isolatedContext) {\n      return this.isolatedContext;\n    }\n\n    this.isolatedContext = {\n      // 1. æ¨¡å—ç³»ç»Ÿéš”ç¦» - æ ¸å¿ƒåŠŸèƒ½\n      require: this.createIsolatedRequire(),\n      module: { exports: {} },\n      exports: {},\n      \n      // 2. è¿›ç¨‹ç¯å¢ƒéš”ç¦»\n      process: this.createIsolatedProcess(),\n      \n      // 3. å…¨å±€å¯¹è±¡éš”ç¦»\n      ...this.createIsolatedGlobals(),\n      \n      // 4. è·¯å¾„ç›¸å…³éš”ç¦»\n      __dirname: this.workingPath,\n      __filename: path.join(this.workingPath, 'sandbox.js'),\n      \n      // 5. æ³¨å…¥å—é™çš„ fsï¼ˆç›´æ¥å¯ç”¨ï¼‰\n      fs: this.createRestrictedFS(),\n      \n      // 6. é˜»æ­¢åŠ¨æ€ä»£ç æ‰§è¡Œ\n      eval: () => {\n        throw new Error('[SandboxIsolation] eval is not allowed in sandbox');\n      },\n      Function: undefined\n    };\n\n    return this.isolatedContext;\n  }\n\n  /**\n   * åˆ›å»ºéš”ç¦»çš„requireå‡½æ•° - è§£å†³æ ¸å¿ƒä¾èµ–åŠ è½½é—®é¢˜\n   * @returns {Function} éš”ç¦»çš„requireå‡½æ•°\n   */\n  createIsolatedRequire() {\n    // å…³é”®ï¼šä½¿ç”¨Module.createRequireåˆ›å»ºç»‘å®šåˆ°toolboxè·¯å¾„çš„require\n    const contextFile = path.join(this.toolboxPath, 'package.json');\n    let sandboxRequire;\n    \n    try {\n      // åˆ›å»ºç»‘å®šåˆ°toolboxä¸Šä¸‹æ–‡çš„requireï¼ˆä¾èµ–åœ¨è¿™é‡Œï¼‰\n      sandboxRequire = Module.createRequire(contextFile);\n    } catch (error) {\n      // fallback: å¦‚æœpackage.jsonä¸å­˜åœ¨ï¼Œä½¿ç”¨è™šæ‹Ÿè·¯å¾„\n      const virtualContextFile = path.join(this.toolboxPath, 'virtual-context.js');\n      sandboxRequire = Module.createRequire(virtualContextFile);\n    }\n\n    // è¿”å›å¢å¼ºçš„requireå‡½æ•°\n    return (moduleName) => {\n      // æ‹¦æˆª fs å’Œç›¸å…³æ¨¡å—\n      if (moduleName === 'fs' || moduleName === 'fs/promises') {\n        return this.createRestrictedFS();\n      }\n      \n      // æ‹¦æˆª child_processï¼Œç¦æ­¢ä½¿ç”¨\n      if (moduleName === 'child_process') {\n        throw new Error('[SandboxIsolation] child_process is not allowed in sandbox');\n      }\n      \n      // æ‹¦æˆª path æ¨¡å—ï¼Œæä¾›å—é™ç‰ˆæœ¬\n      if (moduleName === 'path') {\n        return this.createRestrictedPath();\n      }\n      \n      try {\n        // ä¼˜å…ˆä½¿ç”¨æ²™ç®±requireï¼ˆè‡ªåŠ¨å¤„ç†ç¬¦å·é“¾æ¥ï¼‰\n        return sandboxRequire(moduleName);\n      } catch (error) {\n        // æ™ºèƒ½fallbackå¤„ç†\n        return this.handleRequireFallback(moduleName, error);\n      }\n    };\n  }\n\n  /**\n   * å¤„ç†requireå¤±è´¥çš„æ™ºèƒ½fallback\n   * @param {string} moduleName - æ¨¡å—å\n   * @param {Error} error - åŸå§‹é”™è¯¯\n   * @returns {*} æ¨¡å—å¯¹è±¡æˆ–æŠ›å‡ºé”™è¯¯\n   */\n  handleRequireFallback(moduleName, error) {\n    // 1. å°è¯•åŠ è½½Node.jså†…ç½®æ¨¡å—\n    if (this.options.enableBuiltinModules && this.isBuiltinModule(moduleName)) {\n      try {\n        return require(moduleName);\n      } catch (builtinError) {\n        // å†…ç½®æ¨¡å—åŠ è½½å¤±è´¥ï¼Œç»§ç»­ä¸‹ä¸€æ­¥\n      }\n    }\n\n    // 2. å¦‚æœæ˜¯åˆ†æé˜¶æ®µä¸”æ¨¡å—ä¸å­˜åœ¨ï¼Œè¿”å›mockå¯¹è±¡\n    if (this.options.analysisMode && error.code === 'MODULE_NOT_FOUND') {\n      logger.debug(`[SandboxIsolation] Analysis mode: mocking module ${moduleName}`);\n      return this.createMockModule();\n    }\n\n    // 3. å…¶ä»–æƒ…å†µç›´æ¥æŠ›å‡ºåŸå§‹é”™è¯¯\n    throw error;\n  }\n\n  /**\n   * æ£€æŸ¥æ˜¯å¦ä¸ºNode.jså†…ç½®æ¨¡å—\n   * @param {string} moduleName - æ¨¡å—å\n   * @returns {boolean} æ˜¯å¦ä¸ºå†…ç½®æ¨¡å—\n   */\n  isBuiltinModule(moduleName) {\n    const builtinModules = [\n      'path', 'fs', 'url', 'crypto', 'util', 'os', 'events', 'stream',\n      'http', 'https', 'querystring', 'zlib', 'buffer', 'child_process'\n    ];\n    \n    return builtinModules.includes(moduleName) || moduleName.startsWith('node:');\n  }\n\n  /**\n   * åˆ›å»ºmockæ¨¡å—å¯¹è±¡\n   * @returns {Object} mockå¯¹è±¡\n   */\n  createMockModule() {\n    return new Proxy({}, {\n      get: () => () => ({}),  // æ‰€æœ‰å±æ€§å’Œæ–¹æ³•éƒ½è¿”å›ç©ºå‡½æ•°/å¯¹è±¡\n      apply: () => ({}),      // å¦‚æœè¢«å½“ä½œå‡½æ•°è°ƒç”¨\n      construct: () => ({})   // å¦‚æœè¢«å½“ä½œæ„é€ å‡½æ•°\n    });\n  }\n\n  /**\n   * åˆ›å»ºå—é™çš„æ–‡ä»¶ç³»ç»Ÿ\n   * å®ç°å®Œå…¨é€æ˜çš„æ‹¦æˆªï¼Œåœ¨VMå±‚é¢æ§åˆ¶æ–‡ä»¶è®¿é—®è¾¹ç•Œ\n   * @returns {Object} å—é™çš„fså¯¹è±¡\n   */\n  createRestrictedFS() {\n    const realFs = require('fs');\n    const boundary = path.resolve(this.workingPath); // è½¬ä¸ºç»å¯¹è·¯å¾„\n    \n    logger.info(`[SandboxFS] Creating restricted FS with boundary: ${boundary}`);\n    \n    // æ ¸å¿ƒï¼šæ™ºèƒ½è·¯å¾„è§£æï¼Œé˜²æ­¢ç›¸å¯¹è·¯å¾„è¶Šæƒ\n    const resolveSafePath = (inputPath) => {\n      // å¤„ç†undefinedæˆ–nullçš„æƒ…å†µ\n      if (!inputPath) {\n        throw new Error('[SandboxFS] Path is required');\n      }\n      \n      // 1. å¤„ç†å„ç§è·¯å¾„å½¢å¼\n      let resolved;\n      \n      if (path.isAbsolute(inputPath)) {\n        // ç»å¯¹è·¯å¾„ï¼šç›´æ¥è§£æ\n        resolved = path.resolve(inputPath);\n      } else {\n        // ç›¸å¯¹è·¯å¾„ï¼šåŸºäº workingPath è§£æ\n        // è¿™æ˜¯å…³é”®ï¼é˜²æ­¢ ../../ è¶Šæƒ\n        resolved = path.resolve(boundary, inputPath);\n      }\n      \n      // 2. è§„èŒƒåŒ–è·¯å¾„ï¼ˆå¤„ç† .. å’Œ . ï¼‰\n      resolved = path.normalize(resolved);\n      \n      // 3. è¾¹ç•Œæ£€æŸ¥\n      if (!resolved.startsWith(boundary)) {\n        // è®°å½•è¯¦ç»†ä¿¡æ¯ç”¨äºè°ƒè¯•\n        logger.error(`[SandboxFS] æ–‡ä»¶è®¿é—®è¶Šæƒå°è¯•ï¼š\n          è¾“å…¥è·¯å¾„: ${inputPath}\n          è§£æç»“æœ: ${resolved}\n          å…è®¸è¾¹ç•Œ: ${boundary}\n          è°ƒç”¨æ ˆ: ${new Error().stack}\n        `);\n        \n        throw new Error(\n          `[SandboxFS] æ–‡ä»¶è®¿é—®è¢«æ‹’ç»ï¼šè·¯å¾„ \"${inputPath}\" è¶…å‡ºå·¥ä½œç›®å½•è¾¹ç•Œ ${boundary}`\n        );\n      }\n      \n      return resolved;\n    };\n    \n    // åˆ›å»º Proxy æ¥æ‹¦æˆªæ‰€æœ‰ fs æ“ä½œ\n    const handler = {\n      get(target, prop) {\n        const original = target[prop];\n        \n        // å¦‚æœä¸æ˜¯å‡½æ•°ï¼Œç›´æ¥è¿”å›\n        if (typeof original !== 'function') {\n          // å¤„ç† fs.promises\n          if (prop === 'promises') {\n            return new Proxy(realFs.promises, {\n              get(promiseTarget, promiseProp) {\n                const promiseOriginal = promiseTarget[promiseProp];\n                if (typeof promiseOriginal !== 'function') {\n                  return promiseOriginal;\n                }\n                \n                // åŒ…è£… promises æ–¹æ³•\n                return async function(...args) {\n                  // è¯†åˆ«è·¯å¾„å‚æ•°ï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªï¼‰\n                  if (args.length > 0 && typeof args[0] === 'string') {\n                    args[0] = resolveSafePath(args[0]);\n                  }\n                  \n                  // å¤„ç† renameã€copyFile ç­‰åŒè·¯å¾„æ“ä½œ\n                  if ((promiseProp === 'rename' || promiseProp === 'copyFile') && args.length > 1) {\n                    args[1] = resolveSafePath(args[1]);\n                  }\n                  \n                  // è°ƒç”¨åŸå§‹å‡½æ•°\n                  return await promiseOriginal.apply(promiseTarget, args);\n                };\n              }\n            });\n          }\n          \n          return original;\n        }\n        \n        // åŒ…è£…åŒæ­¥å‡½æ•°\n        return function(...args) {\n          // è¯†åˆ«è·¯å¾„å‚æ•°ï¼ˆé€šå¸¸æ˜¯ç¬¬ä¸€ä¸ªï¼‰\n          if (args.length > 0 && typeof args[0] === 'string') {\n            args[0] = resolveSafePath(args[0]);\n          }\n          \n          // å¤„ç† renameã€copyFile ç­‰åŒè·¯å¾„æ“ä½œ\n          if ((prop === 'renameSync' || prop === 'copyFileSync') && args.length > 1) {\n            args[1] = resolveSafePath(args[1]);\n          }\n          \n          // è°ƒç”¨åŸå§‹å‡½æ•°\n          return original.apply(target, args);\n        };\n      }\n    };\n    \n    // è¿”å›ä»£ç†çš„ fs å¯¹è±¡\n    return new Proxy(realFs, handler);\n  }\n\n  /**\n   * åˆ›å»ºå—é™çš„ path æ¨¡å—\n   * é˜²æ­¢ä½¿ç”¨ path.resolve ç»•è¿‡é™åˆ¶\n   * @returns {Object} å—é™çš„pathå¯¹è±¡\n   */\n  createRestrictedPath() {\n    const realPath = require('path');\n    const boundary = path.resolve(this.workingPath);\n    \n    return new Proxy(realPath, {\n      get(target, prop) {\n        if (prop === 'resolve') {\n          return (...args) => {\n            const resolved = target.resolve(...args);\n            // å¦‚æœè§£æç»“æœè¶…å‡ºè¾¹ç•Œï¼Œè®°å½•è­¦å‘Š\n            if (!resolved.startsWith(boundary)) {\n              logger.warn(`[SandboxPath] path.resolve å°è¯•è¶Šæƒ: ${resolved}`);\n            }\n            return resolved;\n          };\n        }\n        return target[prop];\n      }\n    });\n  }\n\n  /**\n   * åˆ›å»ºéš”ç¦»çš„processå¯¹è±¡\n   * @returns {Object} éš”ç¦»çš„processå¯¹è±¡\n   */\n  createIsolatedProcess() {\n    return {\n      // ç¯å¢ƒå˜é‡ï¼ˆæµ…æ‹·è´ï¼Œé¿å…æ±¡æŸ“ï¼‰\n      env: { ...process.env },\n      \n      // å·¥ä½œç›®å½•è¿”å› workingPathï¼ˆ~/.promptxï¼‰\n      cwd: () => this.workingPath,\n      \n      // å®‰å…¨çš„åªè¯»å±æ€§\n      version: process.version,\n      platform: process.platform,\n      arch: process.arch,\n      pid: process.pid,\n      \n      // æ—¶é—´ç›¸å…³\n      hrtime: process.hrtime,\n      uptime: process.uptime,\n      \n      // ç¦ç”¨å±é™©æ–¹æ³•\n      exit: () => { throw new Error('[SandboxIsolation] process.exit() is not allowed in sandbox'); },\n      abort: () => { throw new Error('[SandboxIsolation] process.abort() is not allowed in sandbox'); },\n      \n      // é˜»æ­¢åº•å±‚è®¿é—®\n      binding: () => {\n        throw new Error('[SandboxIsolation] process.binding() is not allowed in sandbox');\n      },\n      dlopen: () => {\n        throw new Error('[SandboxIsolation] Native modules are not allowed in sandbox');\n      }\n    };\n  }\n\n  /**\n   * åˆ›å»ºéš”ç¦»çš„å…¨å±€å¯¹è±¡\n   * @returns {Object} å®‰å…¨çš„å…¨å±€å¯¹è±¡é›†åˆ\n   */\n  createIsolatedGlobals() {\n    return {\n      // åŸºç¡€ç±»å‹\n      Object: Object,\n      Array: Array,\n      String: String,\n      Number: Number,\n      Boolean: Boolean,\n      Date: Date,\n      RegExp: RegExp,\n      Error: Error,\n      \n      // JSONå¤„ç†\n      JSON: JSON,\n      \n      // æ•°å­¦å¯¹è±¡\n      Math: Math,\n      \n      // URLå¤„ç†\n      URL: URL,\n      URLSearchParams: URLSearchParams,\n      \n      // ç¼“å†²åŒº\n      Buffer: Buffer,\n      \n      // å®šæ—¶å™¨\n      setTimeout: setTimeout,\n      clearTimeout: clearTimeout,\n      setInterval: setInterval,\n      clearInterval: clearInterval,\n      setImmediate: setImmediate,\n      clearImmediate: clearImmediate,\n      \n      // è¾“å‡º\n      console: console,  // Keep console for sandboxed code\n      \n      // Promiseç›¸å…³\n      Promise: Promise\n    };\n  }\n\n  /**\n   * å¯ç”¨åˆ†ææ¨¡å¼ - ç”¨äºå·¥å…·åˆ†æé˜¶æ®µ\n   */\n  enableAnalysisMode() {\n    this.options.analysisMode = true;\n    // é‡ç½®ä¸Šä¸‹æ–‡ä»¥åº”ç”¨æ–°é€‰é¡¹\n    this.isolatedContext = null;\n  }\n\n  /**\n   * å¯ç”¨æ‰§è¡Œæ¨¡å¼ - ç”¨äºå·¥å…·æ‰§è¡Œé˜¶æ®µ\n   */\n  enableExecutionMode() {\n    this.options.analysisMode = false;\n    // é‡ç½®ä¸Šä¸‹æ–‡ä»¥åº”ç”¨æ–°é€‰é¡¹\n    this.isolatedContext = null;\n  }\n\n  /**\n   * æ¸…ç†éš”ç¦»ç®¡ç†å™¨\n   */\n  cleanup() {\n    this.isolatedContext = null;\n  }\n\n  /**\n   * è·å–éš”ç¦»çŠ¶æ€ä¿¡æ¯\n   * @returns {Object} çŠ¶æ€ä¿¡æ¯\n   */\n  getIsolationStatus() {\n    return {\n      sandboxPath: this.sandboxPath,\n      options: this.options,\n      contextCreated: !!this.isolatedContext,\n      timestamp: new Date().toISOString()\n    };\n  }\n}\n\nmodule.exports = SandboxIsolationManager;","/**\n * SandboxErrorManager - ToolSandboxæ™ºèƒ½é”™è¯¯ç®¡ç†å™¨\n * \n * è®¾è®¡åŸåˆ™ï¼š\n * - ä¸ç°æœ‰ToolCommandé”™è¯¯ä½“ç³»å…¼å®¹\n * - æä¾›Agentå‹å¥½çš„é”™è¯¯ä¿¡æ¯å’Œè‡ªåŠ¨æ¢å¤å»ºè®®\n * - æ”¯æŒMCPåè®®çš„ç»“æ„åŒ–é”™è¯¯å“åº”\n * - éµå¾ªå¥¥å¡å§†å‰ƒåˆ€åŸåˆ™ï¼Œæœ€ç®€åŒ–é”™è¯¯å¤„ç†æµç¨‹\n */\n\nclass SandboxErrorManager {\n  constructor() {\n    this.version = '1.0.0';\n  }\n\n  /**\n   * åˆ†æåŸå§‹é”™è¯¯å¹¶ç”Ÿæˆæ™ºèƒ½é”™è¯¯ä¿¡æ¯\n   * @param {Error} originalError - åŸå§‹é”™è¯¯å¯¹è±¡\n   * @param {Object} context - é”™è¯¯ä¸Šä¸‹æ–‡ä¿¡æ¯\n   * @param {string} context.toolId - å·¥å…·ID\n   * @param {Array} context.dependencies - å£°æ˜çš„ä¾èµ–åˆ—è¡¨\n   * @param {string} context.sandboxPath - æ²™ç®±è·¯å¾„\n   * @param {string} context.phase - æ‰§è¡Œé˜¶æ®µ (analyze|prepare|execute)\n   * @returns {Object} å¢å¼ºçš„é”™è¯¯ä¿¡æ¯\n   */\n  analyzeError(originalError, context = {}) {\n    const errorType = this.classifyError(originalError, context);\n    const agentInstructions = this.generateAgentInstructions(errorType, originalError, context);\n    \n    return {\n      // ä¿æŒä¸ToolCommandå…¼å®¹çš„åŸå§‹ä¿¡æ¯\n      originalError,\n      message: originalError.message,\n      \n      // å¢å¼ºçš„æ™ºèƒ½ä¿¡æ¯\n      type: errorType,\n      agentInstructions,\n      context,\n      \n      // MCPå‹å¥½çš„æ ¼å¼åŒ–æ¶ˆæ¯\n      formattedMessage: this.formatForMCP(errorType, originalError, agentInstructions, context)\n    };\n  }\n\n  /**\n   * é”™è¯¯åˆ†ç±»é€»è¾‘\n   * @param {Error} error - é”™è¯¯å¯¹è±¡\n   * @param {Object} context - ä¸Šä¸‹æ–‡ä¿¡æ¯\n   * @returns {string} é”™è¯¯ç±»å‹\n   */\n  classifyError(error, context) {\n    const message = error.message.toLowerCase();\n    \n    // ä¾èµ–ç¼ºå¤±é”™è¯¯ - æœ€å¸¸è§çš„é—®é¢˜\n    if (message.includes('cannot find module')) {\n      const missingModule = this.extractModuleName(error.message);\n      \n      // å…¼å®¹æ–°æ—§æ ¼å¼\n      let isDeclaredDependency = false;\n      if (Array.isArray(context.dependencies)) {\n        // æ—§æ ¼å¼ï¼šæ•°ç»„\n        isDeclaredDependency = context.dependencies.some(dep => \n          dep.split('@')[0] === missingModule\n        );\n      } else if (typeof context.dependencies === 'object' && context.dependencies) {\n        // æ–°æ ¼å¼ï¼šå¯¹è±¡\n        isDeclaredDependency = Object.keys(context.dependencies).includes(missingModule);\n      }\n      \n      if (isDeclaredDependency) {\n        return 'DEPENDENCY_MISSING';\n      } else {\n        return 'UNDECLARED_DEPENDENCY';\n      }\n    }\n    \n    // ä¾èµ–å®‰è£…å¤±è´¥\n    if (message.includes('pnpm install failed') || \n        message.includes('dependency installation') ||\n        message.includes('npm err')) {\n      return 'DEPENDENCY_INSTALL_FAILED';\n    }\n    \n    // å·¥å…·æ–‡ä»¶é—®é¢˜\n    if (message.includes('failed to load tool') ||\n        message.includes('tool does not export') ||\n        message.includes('invalid tool export format')) {\n      return 'TOOL_LOADING_ERROR';\n    }\n    \n    // å‚æ•°éªŒè¯é”™è¯¯\n    if (message.includes('parameter validation failed') ||\n        message.includes('missing required parameter')) {\n      return 'PARAMETER_VALIDATION_ERROR';\n    }\n    \n    // æ²™ç®±ç¯å¢ƒé”™è¯¯\n    if (message.includes('sandbox') || message.includes('vm')) {\n      return 'SANDBOX_ENVIRONMENT_ERROR';\n    }\n    \n    // ç½‘ç»œè¶…æ—¶\n    if (message.includes('timeout') || message.includes('etimedout')) {\n      return 'NETWORK_TIMEOUT';\n    }\n    \n    return 'UNKNOWN_ERROR';\n  }\n\n  /**\n   * ä¸ºAgentç”Ÿæˆæ™ºèƒ½æŒ‡ä»¤\n   * @param {string} errorType - é”™è¯¯ç±»å‹\n   * @param {Error} originalError - åŸå§‹é”™è¯¯\n   * @param {Object} context - ä¸Šä¸‹æ–‡\n   * @returns {Object} AgentæŒ‡ä»¤å¯¹è±¡\n   */\n  generateAgentInstructions(errorType, originalError, context) {\n    switch (errorType) {\n      case 'DEPENDENCY_MISSING':\n        return {\n          action: 'AUTO_RETRY_WITH_FORCE_REINSTALL',\n          autoRetryable: true,\n          command: 'è‡ªåŠ¨é‡è¯•ï¼Œæ·»åŠ  forceReinstall: true å‚æ•°',\n          explanation: 'ä¾èµ–å·²å£°æ˜ä½†æœªæ­£ç¡®å®‰è£…ï¼Œé€šè¿‡å¼ºåˆ¶é‡è£…å¯è§£å†³',\n          userMessage: `æ£€æµ‹åˆ°ä¾èµ– ${this.extractModuleName(originalError.message)} å®‰è£…ä¸å®Œæ•´ï¼Œæ­£åœ¨è‡ªåŠ¨é‡æ–°å®‰è£…...`,\n          retryParameters: { forceReinstall: true }\n        };\n        \n      case 'UNDECLARED_DEPENDENCY': {\n        const missingModule = this.extractModuleName(originalError.message);\n        return {\n          action: 'REPORT_MISSING_DEPENDENCY',\n          autoRetryable: false,\n          command: 'æç¤ºå·¥å…·å¼€å‘è€…æ·»åŠ ä¾èµ–å£°æ˜',\n          explanation: `å·¥å…·ä»£ç ä½¿ç”¨äº†æœªå£°æ˜çš„ä¾èµ–: ${missingModule}`,\n          userMessage: `âŒ å·¥å…·ç¼ºå°‘ä¾èµ–å£°æ˜\n\nğŸ”§ éœ€è¦åœ¨å·¥å…·çš„ getDependencies() æ–¹æ³•ä¸­æ·»åŠ ï¼š\n   '${missingModule}': 'latest'\n\nğŸ“ å®Œæ•´ç¤ºä¾‹ï¼ˆæ–°æ ¼å¼ï¼‰ï¼š\n   getDependencies() {\n     return {\n       ${context.dependencies && typeof context.dependencies === 'object' && !Array.isArray(context.dependencies) \n         ? Object.entries(context.dependencies).map(([k, v]) => `'${k}': '${v}'`).join(',\\n       ') + ','\n         : '// å…¶ä»–ä¾èµ–...'}\n       '${missingModule}': 'latest'\n     };\n   }`,\n          developerAction: `åœ¨ ${context.toolId}.tool.js çš„ getDependencies() ä¸­æ·»åŠ  '${missingModule}': 'latest'`\n        };\n      }\n        \n      case 'DEPENDENCY_INSTALL_FAILED':\n        return {\n          action: 'CHECK_NETWORK_AND_RETRY',\n          autoRetryable: false,\n          command: 'æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œå»ºè®®ç”¨æˆ·ç¨åé‡è¯•',\n          explanation: 'ä¾èµ–å®‰è£…è¿‡ç¨‹å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–åŒ…æºé—®é¢˜',\n          userMessage: `âŒ ä¾èµ–å®‰è£…å¤±è´¥\n\nğŸŒ å¯èƒ½åŸå› ï¼š\n   â€¢ ç½‘ç»œè¿æ¥ä¸ç¨³å®š\n   â€¢ npm/pnpm é•œåƒæºé—®é¢˜\n   â€¢ ä¾èµ–åŒ…ç‰ˆæœ¬ä¸å­˜åœ¨\n\nğŸ’¡ å»ºè®®è§£å†³æ–¹æ¡ˆï¼š\n   1. æ£€æŸ¥ç½‘ç»œè¿æ¥\n   2. ç¨åé‡è¯•ï¼ˆä½¿ç”¨ forceReinstall: trueï¼‰\n   3. å¦‚æœæŒç»­å¤±è´¥ï¼Œè¯·è”ç³»å¼€å‘è€…`,\n          retryDelay: 5000\n        };\n        \n      case 'TOOL_LOADING_ERROR':\n        return {\n          action: 'REPORT_TOOL_ERROR',\n          autoRetryable: false,\n          command: 'æŠ¥å‘Šå·¥å…·æ–‡ä»¶é—®é¢˜',\n          explanation: 'å·¥å…·ä»£ç æœ¬èº«å­˜åœ¨é—®é¢˜ï¼Œéœ€è¦å¼€å‘è€…ä¿®å¤',\n          userMessage: `âŒ å·¥å…·åŠ è½½å¤±è´¥\n\nğŸ”§ å·¥å…·ä»£ç é—®é¢˜ï¼š${originalError.message}\n\nğŸ’¡ è¿™æ˜¯å·¥å…·å¼€å‘é—®é¢˜ï¼Œè¯·è”ç³»å·¥å…·ä½œè€…ä¿®å¤`,\n          developerAction: 'æ£€æŸ¥å·¥å…·çš„ module.exports å’ŒåŸºæœ¬è¯­æ³•'\n        };\n        \n      case 'NETWORK_TIMEOUT':\n        return {\n          action: 'RETRY_WITH_EXTENDED_TIMEOUT',\n          autoRetryable: true,\n          command: 'è‡ªåŠ¨é‡è¯•ï¼Œä½¿ç”¨æ›´é•¿çš„è¶…æ—¶æ—¶é—´',\n          explanation: 'ç½‘ç»œè¶…æ—¶ï¼Œä½¿ç”¨æ›´é•¿è¶…æ—¶æ—¶é—´é‡è¯•',\n          userMessage: 'â° ç½‘ç»œè¶…æ—¶ï¼Œæ­£åœ¨ä½¿ç”¨æ›´é•¿è¶…æ—¶æ—¶é—´é‡è¯•...',\n          retryParameters: { timeout: 60000 } // 60ç§’\n        };\n        \n      default:\n        return {\n          action: 'REPORT_UNKNOWN_ERROR',\n          autoRetryable: false,\n          command: 'æŠ¥å‘ŠæœªçŸ¥é”™è¯¯ç»™ç”¨æˆ·',\n          explanation: 'æœªçŸ¥é”™è¯¯ç±»å‹ï¼Œéœ€è¦äººå·¥åˆ†æ',\n          userMessage: `âŒ æ‰§è¡Œå¤±è´¥ï¼š${originalError.message}\n\nğŸ¤– è¿™æ˜¯ä¸€ä¸ªæœªåˆ†ç±»çš„é”™è¯¯ï¼Œè¯·å°†æ­¤ä¿¡æ¯åé¦ˆç»™å¼€å‘è€…ä»¥æ”¹è¿›é”™è¯¯å¤„ç†`,\n          debugInfo: {\n            stack: originalError.stack,\n            context\n          }\n        };\n    }\n  }\n\n  /**\n   * ä¸ºMCPåè®®æ ¼å¼åŒ–é”™è¯¯æ¶ˆæ¯\n   * @param {string} errorType - é”™è¯¯ç±»å‹\n   * @param {Error} originalError - åŸå§‹é”™è¯¯\n   * @param {Object} agentInstructions - AgentæŒ‡ä»¤\n   * @param {Object} context - ä¸Šä¸‹æ–‡\n   * @returns {string} MCPå‹å¥½çš„é”™è¯¯æ¶ˆæ¯\n   */\n  formatForMCP(errorType, originalError, agentInstructions, context) {\n    const emoji = this.getErrorEmoji(errorType);\n    const timestamp = new Date().toISOString();\n    \n    let message = `${emoji} ToolSandboxæ‰§è¡Œå¤±è´¥\n\nğŸ·ï¸ é”™è¯¯ç±»å‹: ${errorType}\nâ° æ—¶é—´: ${timestamp}\nğŸ”§ å·¥å…·: ${context.toolId || 'unknown'}\nğŸ“ é˜¶æ®µ: ${context.phase || 'unknown'}\n\nğŸ“‹ è¯¦ç»†ä¿¡æ¯:\n${originalError.message}\n\nğŸ¤– AIå¤„ç†å»ºè®®:\n${agentInstructions.userMessage || agentInstructions.explanation}`;\n\n    // å¦‚æœå¯ä»¥è‡ªåŠ¨é‡è¯•ï¼Œæ·»åŠ é‡è¯•ä¿¡æ¯\n    if (agentInstructions.autoRetryable) {\n      message += `\n\nğŸ”„ è‡ªåŠ¨æ¢å¤: ${agentInstructions.action}\nâš¡ æ“ä½œ: ${agentInstructions.command}`;\n    }\n\n    return message;\n  }\n\n  /**\n   * ä»é”™è¯¯æ¶ˆæ¯ä¸­æå–æ¨¡å—å\n   * @param {string} errorMessage - é”™è¯¯æ¶ˆæ¯\n   * @returns {string} æ¨¡å—å\n   */\n  extractModuleName(errorMessage) {\n    const match = errorMessage.match(/Cannot (?:find|resolve) module ['\\\"]([^'\\\"]+)['\\\"]/);\n    return match ? match[1] : 'unknown';\n  }\n\n  /**\n   * æ ¹æ®é”™è¯¯ç±»å‹è·å–å¯¹åº”emoji\n   * @param {string} errorType - é”™è¯¯ç±»å‹\n   * @returns {string} emoji\n   */\n  getErrorEmoji(errorType) {\n    const emojiMap = {\n      'DEPENDENCY_MISSING': 'ğŸ“¦',\n      'UNDECLARED_DEPENDENCY': 'ğŸ”',\n      'DEPENDENCY_INSTALL_FAILED': 'ğŸŒ',\n      'TOOL_LOADING_ERROR': 'ğŸ”§',\n      'PARAMETER_VALIDATION_ERROR': 'ğŸ“',\n      'SANDBOX_ENVIRONMENT_ERROR': 'ğŸ—ï¸',\n      'NETWORK_TIMEOUT': 'â°',\n      'UNKNOWN_ERROR': 'â“'\n    };\n    \n    return emojiMap[errorType] || 'âŒ';\n  }\n\n  /**\n   * æ£€æŸ¥é”™è¯¯æ˜¯å¦å¯ä»¥è‡ªåŠ¨æ¢å¤\n   * @param {Object} intelligentError - æ™ºèƒ½é”™è¯¯å¯¹è±¡\n   * @returns {boolean} æ˜¯å¦å¯è‡ªåŠ¨æ¢å¤\n   */\n  isAutoRecoverable(intelligentError) {\n    return intelligentError.agentInstructions.autoRetryable === true;\n  }\n\n  /**\n   * è·å–è‡ªåŠ¨æ¢å¤çš„é‡è¯•å‚æ•°\n   * @param {Object} intelligentError - æ™ºèƒ½é”™è¯¯å¯¹è±¡\n   * @returns {Object|null} é‡è¯•å‚æ•°\n   */\n  getRetryParameters(intelligentError) {\n    return intelligentError.agentInstructions.retryParameters || null;\n  }\n}\n\nmodule.exports = SandboxErrorManager;","const path = require('path');\nconst fs = require('fs').promises;\nconst logger = require('@promptx/logger');\n\n/**\n * ToolDirectoryManager - åŸºäºåè®®çš„å·¥å…·ç›®å½•ç®¡ç†å™¨\n * \n * è´Ÿè´£ç®¡ç†å·¥å…·ç›¸å…³çš„æ‰€æœ‰ç›®å½•ï¼š\n * - å·¥ä½œç›®å½•ï¼šå·¥å…·æ‰§è¡Œæ—¶çš„ process.cwd()\n * - å·¥å…·ç®±ç›®å½•ï¼šä¾èµ–å®‰è£…å’Œéš”ç¦»\n * - ç¼“å­˜ç›®å½•ï¼šå·¥å…·ç¼“å­˜ï¼ˆå¯é€‰ï¼‰\n * - ä¸´æ—¶ç›®å½•ï¼šä¸´æ—¶æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰\n * \n * åŸºäº ResourceManager çš„åè®®ç³»ç»Ÿï¼Œæ”¯æŒè·¨å¹³å°è·¯å¾„è§£æ\n */\nclass ToolDirectoryManager {\n  constructor(toolId, resourceManager) {\n    this.toolId = toolId;\n    this.resourceManager = resourceManager;\n    \n    // ä½¿ç”¨åè®®å®šä¹‰ç›®å½•\n    this.directories = {\n      working: '@user://.promptx',                           // å·¥ä½œç›®å½•\n      toolbox: `@user://.promptx/toolbox/${toolId}`,        // å·¥å…·éš”ç¦»ç›®å½•\n      dependencies: `@user://.promptx/toolbox/${toolId}/node_modules`, // ä¾èµ–ç›®å½•\n      cache: `@user://.promptx/cache/${toolId}`,            // ç¼“å­˜ç›®å½•\n      temp: `@user://.promptx/temp/${toolId}`,              // ä¸´æ—¶æ–‡ä»¶ç›®å½•\n    };\n    \n    // è§£æåçš„å®é™…è·¯å¾„\n    this.resolvedPaths = {};\n  }\n\n  /**\n   * åˆå§‹åŒ–æ‰€æœ‰è·¯å¾„ï¼ˆé€šè¿‡åè®®è§£æï¼‰\n   */\n  async initialize() {\n    for (const [key, protocolPath] of Object.entries(this.directories)) {\n      this.resolvedPaths[key] = await this.resolveProtocolPath(protocolPath);\n    }\n    logger.debug('[ToolDirectoryManager] Initialized paths:', this.resolvedPaths);\n  }\n\n  /**\n   * é€šè¿‡åè®®è§£æè·¯å¾„\n   * @param {string} protocolPath - åè®®è·¯å¾„ï¼Œå¦‚ @user://.promptx\n   * @returns {Promise<string>} è§£æåçš„ç»å¯¹è·¯å¾„\n   */\n  async resolveProtocolPath(protocolPath) {\n    // ä½¿ç”¨ ResourceManager çš„åè®®è§£æèƒ½åŠ›\n    const result = await this.resourceManager.resolveProtocolReference(protocolPath);\n    \n    if (!result.success) {\n      throw new Error(`Failed to resolve protocol path ${protocolPath}: ${result.error}`);\n    }\n    \n    // è·å–å¯¹åº”çš„åè®®å¤„ç†å™¨\n    const protocol = this.resourceManager.protocols.get(result.protocol);\n    if (!protocol) {\n      throw new Error(`Protocol ${result.protocol} not supported`);\n    }\n    \n    // ä½¿ç”¨åè®®å¤„ç†å™¨è§£æå®é™…è·¯å¾„\n    if (typeof protocol.resolvePath === 'function') {\n      return await protocol.resolvePath(result.path, result.queryParams || new Map());\n    } else {\n      throw new Error(`Protocol ${result.protocol} does not support path resolution`);\n    }\n  }\n\n  /**\n   * è·å–å·¥ä½œç›®å½•è·¯å¾„\n   * @returns {string} å·¥ä½œç›®å½•è·¯å¾„\n   */\n  getWorkingPath() {\n    return this.resolvedPaths.working;\n  }\n\n  /**\n   * è·å–å·¥å…·ç®±ç›®å½•è·¯å¾„\n   * @returns {string} å·¥å…·ç®±ç›®å½•è·¯å¾„\n   */\n  getToolboxPath() {\n    return this.resolvedPaths.toolbox;\n  }\n\n  /**\n   * è·å–ä¾èµ–ç›®å½•è·¯å¾„\n   * @returns {string} node_modules è·¯å¾„\n   */\n  getDependenciesPath() {\n    return this.resolvedPaths.dependencies;\n  }\n\n  /**\n   * è·å–ç¼“å­˜ç›®å½•è·¯å¾„\n   * @returns {string} ç¼“å­˜ç›®å½•è·¯å¾„\n   */\n  getCachePath() {\n    return this.resolvedPaths.cache;\n  }\n\n  /**\n   * è·å–ä¸´æ—¶ç›®å½•è·¯å¾„\n   * @returns {string} ä¸´æ—¶ç›®å½•è·¯å¾„\n   */\n  getTempPath() {\n    return this.resolvedPaths.temp;\n  }\n\n  /**\n   * è·å– package.json è·¯å¾„\n   * @returns {string} package.json è·¯å¾„\n   */\n  getPackageJsonPath() {\n    return path.join(this.resolvedPaths.toolbox, 'package.json');\n  }\n\n  /**\n   * ç¡®ä¿å¿…è¦çš„ç›®å½•å­˜åœ¨\n   */\n  async ensureDirectories() {\n    // å·¥ä½œç›®å½•é€šå¸¸å·²å­˜åœ¨ï¼Œä½†è¿˜æ˜¯æ£€æŸ¥ä¸€ä¸‹\n    await this.ensureDirectory(this.resolvedPaths.working);\n    \n    // å·¥å…·ç®±ç›®å½•å¿…é¡»åˆ›å»º\n    await this.ensureDirectory(this.resolvedPaths.toolbox);\n    \n    // å¯é€‰ï¼šåˆ›å»ºç¼“å­˜å’Œä¸´æ—¶ç›®å½•\n    // await this.ensureDirectory(this.resolvedPaths.cache);\n    // await this.ensureDirectory(this.resolvedPaths.temp);\n  }\n\n  /**\n   * ç¡®ä¿å•ä¸ªç›®å½•å­˜åœ¨\n   * @param {string} dirPath - ç›®å½•è·¯å¾„\n   */\n  async ensureDirectory(dirPath) {\n    try {\n      await fs.access(dirPath);\n    } catch (error) {\n      if (error.code === 'ENOENT') {\n        await fs.mkdir(dirPath, { recursive: true });\n        logger.debug(`[ToolDirectoryManager] Created directory: ${dirPath}`);\n      } else {\n        throw error;\n      }\n    }\n  }\n\n  /**\n   * æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨\n   * @param {string} dirPath - ç›®å½•è·¯å¾„\n   * @returns {Promise<boolean>} æ˜¯å¦å­˜åœ¨\n   */\n  async directoryExists(dirPath) {\n    try {\n      await fs.access(dirPath);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * æ£€æŸ¥å·¥å…·ç®±ç›®å½•æ˜¯å¦å­˜åœ¨\n   * @returns {Promise<boolean>}\n   */\n  async toolboxExists() {\n    return await this.directoryExists(this.resolvedPaths.toolbox);\n  }\n\n  /**\n   * æ¸…ç†ä¸´æ—¶æ–‡ä»¶\n   */\n  async cleanupTemp() {\n    if (this.resolvedPaths.temp && await this.directoryExists(this.resolvedPaths.temp)) {\n      const { rmdir } = require('fs').promises;\n      await rmdir(this.resolvedPaths.temp, { recursive: true });\n      logger.debug(`[ToolDirectoryManager] Cleaned up temp directory: ${this.resolvedPaths.temp}`);\n    }\n  }\n\n  /**\n   * åˆ é™¤å·¥å…·ç®±ç›®å½•ï¼ˆç”¨äºå¼ºåˆ¶é‡å»ºï¼‰\n   */\n  async deleteToolbox() {\n    if (this.resolvedPaths.toolbox && await this.toolboxExists()) {\n      const { rmdir } = require('fs').promises;\n      await rmdir(this.resolvedPaths.toolbox, { recursive: true });\n      logger.debug(`[ToolDirectoryManager] Deleted toolbox directory: ${this.resolvedPaths.toolbox}`);\n    }\n  }\n\n  /**\n   * è·å–åè®®è·¯å¾„ï¼ˆç”¨äºæ—¥å¿—æˆ–è°ƒè¯•ï¼‰\n   * @param {string} key - ç›®å½•é”®å\n   * @returns {string} åè®®è·¯å¾„\n   */\n  getProtocolPath(key) {\n    return this.directories[key];\n  }\n\n  /**\n   * æ”¯æŒè‡ªå®šä¹‰åè®®è·¯å¾„ï¼ˆæœªæ¥æ‰©å±•ï¼‰\n   * æ¯”å¦‚æ”¯æŒ @project:// æˆ– @s3:// ç­‰\n   */\n  async setCustomDirectory(key, protocolPath) {\n    this.directories[key] = protocolPath;\n    this.resolvedPaths[key] = await this.resolveProtocolPath(protocolPath);\n  }\n}\n\nmodule.exports = ToolDirectoryManager;","const path = require('path');\nconst fs = require('fs').promises;\nconst logger = require('@promptx/logger');\n\n/**\n * ESModuleRequireSupport - ES Module åŠ è½½æ”¯æŒå™¨\n * \n * ä¸“é—¨å¤„ç† ES Module å’Œ CommonJS æ¨¡å—çš„ç»Ÿä¸€åŠ è½½\n * æä¾›æ™ºèƒ½çš„æ¨¡å—ç±»å‹æ£€æµ‹å’ŒåŠ è½½ç­–ç•¥\n */\nclass ESModuleRequireSupport {\n  constructor(toolboxPath) {\n    this.toolboxPath = toolboxPath;\n    this.moduleTypeCache = new Map(); // ç¼“å­˜æ¨¡å—ç±»å‹ï¼Œé¿å…é‡å¤æ£€æµ‹\n  }\n\n  /**\n   * åˆ›å»ºç»Ÿä¸€çš„ require å‡½æ•°\n   * æ‰€æœ‰æ¨¡å—éƒ½è¿”å› Promiseï¼Œå®ç°ç»Ÿä¸€çš„ä½¿ç”¨ä½“éªŒ\n   * \n   * @param {Function} sandboxRequire - æ²™ç®±ç¯å¢ƒçš„ require å‡½æ•°\n   * @returns {Function} å¢å¼ºçš„ require å‡½æ•°\n   */\n  createUnifiedRequire(sandboxRequire) {\n    return async (moduleName) => {\n      try {\n        // æ£€æµ‹æ¨¡å—ç±»å‹\n        const moduleType = await this.detectModuleType(moduleName);\n        \n        logger.debug(`[ESModuleSupport] Loading ${moduleName} as ${moduleType}`);\n        \n        if (moduleType === 'esm') {\n          // ES Module - ä½¿ç”¨åŠ¨æ€ import\n          return await this.loadESModule(moduleName);\n        } else {\n          // CommonJS - åŒ…è£…æˆ Promise è¿”å›ï¼Œç»Ÿä¸€ä½“éªŒ\n          try {\n            const module = sandboxRequire(moduleName);\n            return Promise.resolve(module);\n          } catch (error) {\n            // å¦‚æœ require å¤±è´¥ä¸”é”™è¯¯æ˜¯ ERR_REQUIRE_ESMï¼Œè¯´æ˜æ˜¯ ES Module\n            if (error.code === 'ERR_REQUIRE_ESM') {\n              logger.debug(`[ESModuleSupport] Fallback to ES Module for ${moduleName}`);\n              return await this.loadESModule(moduleName);\n            }\n            throw error;\n          }\n        }\n      } catch (error) {\n        logger.error(`[ESModuleSupport] Failed to load module ${moduleName}: ${error.message}`);\n        throw new Error(`Cannot load module '${moduleName}': ${error.message}`);\n      }\n    };\n  }\n\n  /**\n   * æ£€æµ‹æ¨¡å—ç±»å‹\n   * @param {string} moduleName - æ¨¡å—å\n   * @returns {Promise<string>} 'esm' | 'commonjs' | 'unknown'\n   */\n  async detectModuleType(moduleName) {\n    // æ£€æŸ¥ç¼“å­˜\n    if (this.moduleTypeCache.has(moduleName)) {\n      return this.moduleTypeCache.get(moduleName);\n    }\n\n    try {\n      const packagePath = this.resolvePackagePath(moduleName);\n      const packageJsonPath = path.join(packagePath, 'package.json');\n      \n      // è¯»å– package.json\n      const packageJsonContent = await fs.readFile(packageJsonPath, 'utf8');\n      const packageJson = JSON.parse(packageJsonContent);\n      \n      let moduleType = 'commonjs'; // é»˜è®¤ä¸º CommonJS\n      \n      // 1. æ£€æŸ¥ type å­—æ®µï¼ˆæœ€æ ‡å‡†çš„æ–¹å¼ï¼‰\n      if (packageJson.type === 'module') {\n        moduleType = 'esm';\n      }\n      // 2. æ£€æŸ¥ exports å­—æ®µä¸­çš„ import æ¡ä»¶\n      else if (packageJson.exports && typeof packageJson.exports === 'object') {\n        // æ£€æŸ¥æ˜¯å¦æœ‰ import æ¡ä»¶å¯¼å‡º\n        if (packageJson.exports.import || \n            (packageJson.exports['.'] && packageJson.exports['.'].import)) {\n          moduleType = 'esm';\n        }\n      }\n      // 3. æ£€æŸ¥ module å­—æ®µï¼ˆä¸€äº›åŒ…ç”¨æ¥æŒ‡å‘ ES Module ç‰ˆæœ¬ï¼‰\n      else if (packageJson.module) {\n        // å¦‚æœæœ‰ module å­—æ®µä½†æ²¡æœ‰ main å­—æ®µï¼Œå¯èƒ½æ˜¯çº¯ ES Module\n        if (!packageJson.main) {\n          moduleType = 'esm';\n        }\n      }\n      \n      // ç¼“å­˜ç»“æœ\n      this.moduleTypeCache.set(moduleName, moduleType);\n      \n      logger.debug(`[ESModuleSupport] Module ${moduleName} detected as ${moduleType}`);\n      return moduleType;\n      \n    } catch (error) {\n      logger.debug(`[ESModuleSupport] Cannot detect module type for ${moduleName}: ${error.message}`);\n      // ç¼“å­˜ä¸º unknown\n      this.moduleTypeCache.set(moduleName, 'unknown');\n      return 'unknown';\n    }\n  }\n\n  /**\n   * è§£æåŒ…è·¯å¾„ï¼ˆæ”¯æŒ scoped åŒ…ï¼‰\n   * @param {string} moduleName - æ¨¡å—å\n   * @returns {string} åŒ…çš„å®é™…è·¯å¾„\n   */\n  resolvePackagePath(moduleName) {\n    const parts = moduleName.split('/');\n    \n    if (moduleName.startsWith('@') && parts.length >= 2) {\n      // Scoped package: @scope/package æˆ– @scope/package/subpath\n      const scopedPackageName = parts.slice(0, 2).join('/');\n      return path.join(this.toolboxPath, 'node_modules', scopedPackageName);\n    } else {\n      // Normal package: package æˆ– package/subpath\n      return path.join(this.toolboxPath, 'node_modules', parts[0]);\n    }\n  }\n\n  /**\n   * åŠ è½½ ES Module\n   * @param {string} moduleName - æ¨¡å—å\n   * @returns {Promise<Object>} æ¨¡å—å¯¹è±¡\n   */\n  async loadESModule(moduleName) {\n    try {\n      // è·å–æ¨¡å—çš„å®Œæ•´è·¯å¾„\n      const modulePath = this.resolveModuleEntryPoint(moduleName);\n      \n      logger.debug(`[ESModuleSupport] Importing ES Module from ${modulePath}`);\n      \n      // ä½¿ç”¨åŠ¨æ€ import åŠ è½½ ES Module\n      const module = await import(modulePath);\n      \n      // è¿”å›æ¨¡å—ï¼ˆå¤„ç† default exportï¼‰\n      return module.default || module;\n      \n    } catch (error) {\n      logger.error(`[ESModuleSupport] Failed to load ES Module ${moduleName}: ${error.message}`);\n      throw new Error(`Failed to import ES Module '${moduleName}': ${error.message}`);\n    }\n  }\n\n  /**\n   * è§£ææ¨¡å—å…¥å£ç‚¹\n   * @param {string} moduleName - æ¨¡å—å\n   * @returns {string} æ¨¡å—å…¥å£æ–‡ä»¶çš„å®Œæ•´è·¯å¾„\n   */\n  resolveModuleEntryPoint(moduleName) {\n    try {\n      const packagePath = this.resolvePackagePath(moduleName);\n      const packageJsonPath = path.join(packagePath, 'package.json');\n      \n      // åŒæ­¥è¯»å– package.jsonï¼ˆå› ä¸ºè¿™ä¸ªæ–¹æ³•å¯èƒ½åœ¨åŒæ­¥ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ï¼‰\n      const packageJson = require(packageJsonPath);\n      \n      // è§£æå…¥å£ç‚¹\n      let entryPoint = 'index.js'; // é»˜è®¤å…¥å£\n      \n      // æ£€æŸ¥ exports å­—æ®µ\n      if (packageJson.exports) {\n        if (typeof packageJson.exports === 'string') {\n          entryPoint = packageJson.exports;\n        } else if (packageJson.exports['.']) {\n          if (typeof packageJson.exports['.'] === 'string') {\n            entryPoint = packageJson.exports['.'];\n          } else if (packageJson.exports['.'].import) {\n            entryPoint = packageJson.exports['.'].import;\n          } else if (packageJson.exports['.'].default) {\n            entryPoint = packageJson.exports['.'].default;\n          }\n        }\n      }\n      // æ£€æŸ¥ module å­—æ®µï¼ˆES Module å…¥å£ï¼‰\n      else if (packageJson.module) {\n        entryPoint = packageJson.module;\n      }\n      // æ£€æŸ¥ main å­—æ®µï¼ˆCommonJS å…¥å£ï¼Œä½†å¯èƒ½ä¹Ÿæ˜¯ ES Moduleï¼‰\n      else if (packageJson.main) {\n        entryPoint = packageJson.main;\n      }\n      \n      // æ„å»ºå®Œæ•´è·¯å¾„\n      const fullPath = path.join(packagePath, entryPoint);\n      \n      // å¤„ç†å­è·¯å¾„å¯¼å…¥ï¼ˆå¦‚ 'lodash/chunk'ï¼‰\n      const parts = moduleName.split('/');\n      if (moduleName.startsWith('@') && parts.length > 2) {\n        // @scope/package/subpath\n        const subpath = parts.slice(2).join('/');\n        return path.join(packagePath, subpath);\n      } else if (!moduleName.startsWith('@') && parts.length > 1) {\n        // package/subpath\n        const subpath = parts.slice(1).join('/');\n        return path.join(packagePath, subpath);\n      }\n      \n      return fullPath;\n      \n    } catch (error) {\n      // å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é»˜è®¤è·¯å¾„\n      return this.resolvePackagePath(moduleName);\n    }\n  }\n\n  /**\n   * æ‰¹é‡æ£€æµ‹ä¾èµ–çš„æ¨¡å—ç±»å‹\n   * @param {Object} dependencies - ä¾èµ–å¯¹è±¡ { packageName: version }\n   * @returns {Promise<Object>} { commonjs: [], esmodule: [], unknown: [] }\n   */\n  async detectDependenciesTypes(dependencies) {\n    const result = {\n      commonjs: [],\n      esmodule: [],\n      unknown: []\n    };\n\n    for (const [packageName, version] of Object.entries(dependencies)) {\n      const moduleType = await this.detectModuleType(packageName);\n      \n      if (moduleType === 'esm') {\n        result.esmodule.push({ name: packageName, version });\n      } else if (moduleType === 'commonjs') {\n        result.commonjs.push({ name: packageName, version });\n      } else {\n        result.unknown.push({ name: packageName, version });\n      }\n    }\n\n    logger.debug(`[ESModuleSupport] Dependencies analysis:`, {\n      commonjs: result.commonjs.length,\n      esmodule: result.esmodule.length,\n      unknown: result.unknown.length\n    });\n\n    return result;\n  }\n\n  /**\n   * æ£€æŸ¥æ˜¯å¦æœ‰ ES Module ä¾èµ–\n   * @param {Object} dependencies - ä¾èµ–å¯¹è±¡\n   * @returns {Promise<boolean>}\n   */\n  async hasESModuleDependencies(dependencies) {\n    const types = await this.detectDependenciesTypes(dependencies);\n    return types.esmodule.length > 0;\n  }\n\n  /**\n   * æ¸…ç†ç¼“å­˜\n   */\n  clearCache() {\n    this.moduleTypeCache.clear();\n  }\n\n  /**\n   * è·å–ç¼“å­˜ç»Ÿè®¡\n   */\n  getCacheStats() {\n    return {\n      size: this.moduleTypeCache.size,\n      modules: Array.from(this.moduleTypeCache.entries())\n    };\n  }\n}\n\nmodule.exports = ESModuleRequireSupport;","/**\n * æœåŠ¡å™¨ç¯å¢ƒå…¨å±€ç®¡ç†å™¨\n * ç®¡ç†MCPæœåŠ¡å™¨çš„æ ¸å¿ƒè¿è¡Œæ—¶å±æ€§ï¼štransportã€hostã€portã€processId\n * å¯åŠ¨æ—¶è£…é…ï¼Œè¿è¡Œæ—¶ç›´æ¥è·å–ï¼Œé¿å…å‚æ•°ä¼ é€’é”™è¯¯\n */\nclass ServerEnvironment {\n  constructor() {\n    this.transport = null   // 'stdio' | 'http' | 'sse'\n    this.host = null       // 'localhost' | '0.0.0.0' ç­‰\n    this.port = null       // ç«¯å£å·ï¼ˆstdioæ¨¡å¼ä¸ºnullï¼‰\n    this.processId = null  // è¿›ç¨‹IDï¼Œç”¨äºç”ŸæˆmcpId\n    this.initialized = false\n  }\n\n  /**\n   * åˆå§‹åŒ–æœåŠ¡ç¯å¢ƒï¼ˆå„å¯åŠ¨æ¸ é“è°ƒç”¨ä¸€æ¬¡ï¼‰\n   * @param {Object} config - é…ç½®å¯¹è±¡\n   * @param {string} config.transport - ä¼ è¾“åè®®\n   * @param {string} config.host - ä¸»æœºåœ°å€ï¼ˆå¯é€‰ï¼‰\n   * @param {number} config.port - ç«¯å£å·ï¼ˆå¯é€‰ï¼‰\n   */\n  initialize(config) {\n    this.transport = config.transport\n    this.host = config.host || null\n    this.port = config.port || null\n    this.processId = process.pid\n    this.initialized = true\n  }\n\n  /**\n   * è·å–MCP IDï¼ˆåŸºäºprocessIdç”Ÿæˆï¼‰\n   * @returns {string} MCPè¿›ç¨‹ID\n   */\n  getMcpId() {\n    if (!this.initialized) {\n      throw new Error('ServerEnvironment not initialized')\n    }\n    return `mcp-${this.processId}`\n  }\n\n  /**\n   * è·å–ä¼ è¾“åè®®\n   * @returns {string} transportç±»å‹\n   */\n  getTransport() {\n    if (!this.initialized) {\n      throw new Error('ServerEnvironment not initialized')\n    }\n    return this.transport\n  }\n\n  /**\n   * è·å–æœåŠ¡å™¨åœ°å€ä¿¡æ¯ï¼ˆä»…HTTP/SSEæ¨¡å¼ï¼‰\n   * @returns {Object|null} {host, port} æˆ– null\n   */\n  getServerAddress() {\n    if (!this.initialized) {\n      throw new Error('ServerEnvironment not initialized')\n    }\n    if (this.transport === 'stdio') {\n      return null\n    }\n    return {\n      host: this.host,\n      port: this.port\n    }\n  }\n\n  /**\n   * æ£€æŸ¥æ˜¯å¦å·²åˆå§‹åŒ–\n   * @returns {boolean}\n   */\n  isInitialized() {\n    return this.initialized\n  }\n}\n\n// åˆ›å»ºå…¨å±€å•ä¾‹å®ä¾‹\nlet globalServerEnvironment = null\n\n/**\n * è·å–å…¨å±€ServerEnvironmentå•ä¾‹\n * @returns {ServerEnvironment} å…¨å±€ServerEnvironmentå®ä¾‹\n */\nfunction getGlobalServerEnvironment() {\n  if (!globalServerEnvironment) {\n    globalServerEnvironment = new ServerEnvironment()\n  }\n  return globalServerEnvironment\n}\n\nmodule.exports = ServerEnvironment\nmodule.exports.getGlobalServerEnvironment = getGlobalServerEnvironment","const fs = require('fs-extra')\nconst path = require('path')\nconst os = require('os')\nconst crypto = require('crypto')\nconst { getGlobalServerEnvironment } = require('./ServerEnvironment')\nconst logger = require('@promptx/logger')\n\n/**\n * ç»Ÿä¸€é¡¹ç›®ç®¡ç†å™¨ - æ–°æ¶æ„\n * æ ¸å¿ƒåŸåˆ™ï¼šä¸€æ¬¡è®¾ç½®ï¼Œå…¨ç¨‹ä½¿ç”¨\n * è´Ÿè´£å½“å‰é¡¹ç›®çŠ¶æ€ç®¡ç†å’Œå¤šé¡¹ç›®é…ç½®æŒä¹…åŒ–\n */\nclass ProjectManager {\n  constructor() {\n    this.promptxHomeDir = path.join(os.homedir(), '.promptx')\n    this.projectsDir = path.join(this.promptxHomeDir, 'project')\n  }\n\n  // ğŸ¯ æ–°æ¶æ„ï¼šå½“å‰é¡¹ç›®çŠ¶æ€ç®¡ç†\n  static currentProject = {\n    workingDirectory: null,\n    mcpId: null,\n    ideType: null,\n    transport: null,\n    initialized: false\n  }\n\n  /**\n   * è®¾ç½®å½“å‰é¡¹ç›®ï¼ˆinitæ—¶è°ƒç”¨ï¼‰\n   * @param {string} workingDirectory - é¡¹ç›®å·¥ä½œç›®å½•ç»å¯¹è·¯å¾„\n   * @param {string} mcpId - MCPè¿›ç¨‹ID\n   * @param {string} ideType - IDEç±»å‹\n   * @param {string} transport - ä¼ è¾“åè®®ç±»å‹\n   */\n  static setCurrentProject(workingDirectory, mcpId, ideType, transport) {\n    this.currentProject = {\n      workingDirectory: path.resolve(workingDirectory),\n      mcpId,\n      ideType,\n      transport,\n      initialized: true\n    }\n  }\n\n  /**\n   * è·å–å½“å‰é¡¹ç›®è·¯å¾„ï¼ˆ@projectåè®®ä½¿ç”¨ï¼‰\n   * @returns {string} å½“å‰é¡¹ç›®å·¥ä½œç›®å½•\n   */\n  static getCurrentProjectPath() {\n    logger.debug(`[ProjectManager DEBUG] getCurrentProjectPathè¢«è°ƒç”¨`)\n    logger.debug(`[ProjectManager DEBUG] currentProject.initialized: ${this.currentProject.initialized}`)\n    logger.debug(`[ProjectManager DEBUG] currentProjectçŠ¶æ€:`, JSON.stringify(this.currentProject, null, 2))\n    \n    // è¾“å‡ºå®Œæ•´çš„è°ƒç”¨æ ˆï¼ŒåŒ…å«æ–‡ä»¶åå’Œè¡Œå·\n    const stack = new Error().stack\n    const stackLines = stack.split('\\n').slice(1, 8) // å–å‰7å±‚è°ƒç”¨æ ˆ\n    logger.error(`[ProjectManager DEBUG] å®Œæ•´è°ƒç”¨æ ˆ:`)\n    stackLines.forEach((line, index) => {\n      logger.error(`[ProjectManager DEBUG]   ${index + 1}. ${line.trim()}`)\n    })\n    \n    if (!this.currentProject.initialized) {\n      logger.error(`[ProjectManager DEBUG] âŒ é¡¹ç›®æœªåˆå§‹åŒ–ï¼Œå°†æŠ›å‡ºé”™è¯¯`)\n      throw new Error('é¡¹ç›®æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆè°ƒç”¨ init å‘½ä»¤')\n    }\n    \n    logger.debug(`[ProjectManager DEBUG] âœ… è¿”å›é¡¹ç›®è·¯å¾„: ${this.currentProject.workingDirectory}`)\n    return this.currentProject.workingDirectory\n  }\n\n  /**\n   * è·å–å½“å‰é¡¹ç›®ä¿¡æ¯\n   * @returns {Object} å½“å‰é¡¹ç›®å®Œæ•´ä¿¡æ¯\n   */\n  static getCurrentProject() {\n    logger.debug(`[ProjectManager DEBUG] getCurrentProjectè¢«è°ƒç”¨`)\n    logger.debug(`[ProjectManager DEBUG] currentProject.initialized: ${this.currentProject.initialized}`)\n    logger.debug(`[ProjectManager DEBUG] currentProjectçŠ¶æ€:`, JSON.stringify(this.currentProject, null, 2))\n    \n    if (!this.currentProject.initialized) {\n      logger.error(`[ProjectManager DEBUG] âŒ é¡¹ç›®æœªåˆå§‹åŒ–ï¼Œå°†æŠ›å‡ºé”™è¯¯`)\n      throw new Error('é¡¹ç›®æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆè°ƒç”¨ init å‘½ä»¤')\n    }\n    \n    logger.debug(`[ProjectManager DEBUG] âœ… è¿”å›é¡¹ç›®ä¿¡æ¯`)\n    return { ...this.currentProject }\n  }\n\n  /**\n   * æ£€æŸ¥é¡¹ç›®æ˜¯å¦å·²åˆå§‹åŒ–\n   * @returns {boolean} æ˜¯å¦å·²åˆå§‹åŒ–\n   */\n  static isInitialized() {\n    return this.currentProject.initialized\n  }\n\n  /**\n   * æ³¨å†Œé¡¹ç›®åˆ°MCPå®ä¾‹ - ä½¿ç”¨Hashç›®å½•ç»“æ„\n   * @param {string} projectPath - é¡¹ç›®ç»å¯¹è·¯å¾„\n   * @param {string} mcpId - MCPè¿›ç¨‹ID\n   * @param {string} ideType - IDEç±»å‹ï¼ˆcursor/vscodeç­‰ï¼‰\n   * @param {string} transport - ä¼ è¾“åè®®ç±»å‹ï¼ˆstdio/http/sseï¼‰\n   * @returns {Promise<Object>} é¡¹ç›®é…ç½®å¯¹è±¡\n   */\n  async registerProject(projectPath, mcpId, ideType, transport = 'stdio') {\n    // éªŒè¯é¡¹ç›®è·¯å¾„\n    if (!await this.validateProjectPath(projectPath)) {\n      throw new Error(`æ— æ•ˆçš„é¡¹ç›®è·¯å¾„: ${projectPath}`)\n    }\n\n    // ç”Ÿæˆé¡¹ç›®é…ç½®\n    const projectConfig = {\n      mcpId: mcpId,\n      ideType: ideType.toLowerCase(),\n      transport: transport.toLowerCase(),\n      projectPath: path.resolve(projectPath),\n      projectHash: this.generateProjectHash(projectPath)\n    }\n\n    // ç”Ÿæˆé¡¹ç›®Hashç›®å½•\n    const projectHash = this.generateProjectHash(projectPath)\n    const projectConfigDir = path.join(this.projectsDir, projectHash)\n\n    // ğŸ¯ ç¡®ä¿Hashç›®å½•å’Œ.promptxå­ç›®å½•å­˜åœ¨\n    await fs.ensureDir(projectConfigDir)\n    await fs.ensureDir(path.join(projectConfigDir, '.promptx'))\n    await fs.ensureDir(path.join(projectConfigDir, '.promptx', 'memory'))\n    await fs.ensureDir(path.join(projectConfigDir, '.promptx', 'resource'))\n\n    // ç”Ÿæˆé…ç½®æ–‡ä»¶åå¹¶ä¿å­˜åˆ°Hashç›®å½•ä¸‹\n    const fileName = this.generateConfigFileName(mcpId, ideType, transport, projectPath)\n    const configPath = path.join(projectConfigDir, fileName)\n    \n    await fs.writeJson(configPath, projectConfig, { spaces: 2 })\n    \n    return projectConfig\n  }\n\n  /**\n   * æ ¹æ®MCP IDè·å–å•ä¸ªé¡¹ç›®é…ç½®ï¼ˆå‡è®¾åªæœ‰ä¸€ä¸ªé¡¹ç›®ï¼‰\n   * @param {string} mcpId - MCPè¿›ç¨‹ID\n   * @returns {Promise<Object|null>} é¡¹ç›®é…ç½®å¯¹è±¡\n   */\n  async getProjectByMcpId(mcpId) {\n    const projects = await this.getProjectsByMcpId(mcpId)\n    return projects.length > 0 ? projects[0] : null\n  }\n\n  /**\n   * æ ¹æ®MCP IDè·å–æ‰€æœ‰ç»‘å®šçš„é¡¹ç›®é…ç½® - æ”¯æŒHashç›®å½•ç»“æ„\n   * @param {string} mcpId - MCPè¿›ç¨‹ID\n   * @returns {Promise<Array>} é¡¹ç›®é…ç½®æ•°ç»„\n   */\n  async getProjectsByMcpId(mcpId) {\n    if (!await fs.pathExists(this.projectsDir)) {\n      return []\n    }\n\n    const hashDirs = await fs.readdir(this.projectsDir)\n    const projects = []\n\n    for (const hashDir of hashDirs) {\n      const hashDirPath = path.join(this.projectsDir, hashDir)\n      \n      // ğŸ¯ åªå¤„ç†Hashç›®å½•ï¼ˆå¿½ç•¥æ—§çš„å¹³é“ºæ–‡ä»¶ï¼‰\n      if (!(await fs.stat(hashDirPath)).isDirectory()) {\n        continue\n      }\n      \n      try {\n        const configFiles = await fs.readdir(hashDirPath)\n        for (const file of configFiles) {\n          // æŸ¥æ‰¾MCPé…ç½®æ–‡ä»¶\n          if (file.startsWith('mcp-') && file.endsWith('.json')) {\n            try {\n              const configPath = path.join(hashDirPath, file)\n              const config = await fs.readJson(configPath)\n              if (config.mcpId === mcpId) {\n                projects.push(config)\n              }\n            } catch (error) {\n              // å¿½ç•¥æŸåçš„é…ç½®æ–‡ä»¶\n              logger.warn(`è·³è¿‡æŸåçš„é…ç½®æ–‡ä»¶: ${file}`)\n            }\n          }\n        }\n      } catch (error) {\n        // å¿½ç•¥æ— æ³•è¯»å–çš„ç›®å½•\n        logger.warn(`è·³è¿‡æ— æ³•è¯»å–çš„ç›®å½•: ${hashDir}`)\n      }\n    }\n\n    return projects\n  }\n\n  /**\n   * è·å–ç‰¹å®šé¡¹ç›®çš„æ‰€æœ‰å®ä¾‹ï¼ˆä¸åŒIDE/MCPçš„ç»‘å®šï¼‰ - æ”¯æŒHashç›®å½•ç»“æ„\n   * @param {string} projectPath - é¡¹ç›®è·¯å¾„\n   * @returns {Promise<Array>} é¡¹ç›®å®ä¾‹æ•°ç»„\n   */\n  async getProjectInstances(projectPath) {\n    if (!await fs.pathExists(this.projectsDir)) {\n      return []\n    }\n\n    const projectHash = this.generateProjectHash(projectPath)\n    const projectConfigDir = path.join(this.projectsDir, projectHash)\n    \n    // æ£€æŸ¥Hashç›®å½•æ˜¯å¦å­˜åœ¨\n    if (!await fs.pathExists(projectConfigDir)) {\n      return []\n    }\n\n    const instances = []\n    \n    try {\n      const configFiles = await fs.readdir(projectConfigDir)\n      \n      for (const file of configFiles) {\n        // æŸ¥æ‰¾MCPé…ç½®æ–‡ä»¶\n        if (file.startsWith('mcp-') && file.endsWith('.json')) {\n          try {\n            const configPath = path.join(projectConfigDir, file)\n            const config = await fs.readJson(configPath)\n            if (config.projectHash === projectHash) {\n              instances.push(config)\n            }\n          } catch (error) {\n            logger.warn(`è·³è¿‡æŸåçš„é…ç½®æ–‡ä»¶: ${file}`)\n          }\n        }\n      }\n    } catch (error) {\n      logger.warn(`æ— æ³•è¯»å–é¡¹ç›®é…ç½®ç›®å½•: ${projectConfigDir}`)\n    }\n\n    return instances\n  }\n\n  /**\n   * åˆ é™¤é¡¹ç›®ç»‘å®š - æ”¯æŒHashç›®å½•ç»“æ„\n   * @param {string} mcpId - MCPè¿›ç¨‹ID\n   * @param {string} ideType - IDEç±»å‹\n   * @param {string} transport - ä¼ è¾“åè®®ç±»å‹\n   * @param {string} projectPath - é¡¹ç›®è·¯å¾„\n   * @returns {Promise<boolean>} æ˜¯å¦åˆ é™¤æˆåŠŸ\n   */\n  async removeProject(mcpId, ideType, transport, projectPath) {\n    const projectHash = this.generateProjectHash(projectPath)\n    const projectConfigDir = path.join(this.projectsDir, projectHash)\n    const fileName = this.generateConfigFileName(mcpId, ideType, transport, projectPath)\n    const configPath = path.join(projectConfigDir, fileName)\n    \n    if (await fs.pathExists(configPath)) {\n      await fs.remove(configPath)\n      \n      // ğŸ¯ æ£€æŸ¥Hashç›®å½•æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™åˆ é™¤æ•´ä¸ªç›®å½•\n      try {\n        const remainingFiles = await fs.readdir(projectConfigDir)\n        const mcpConfigFiles = remainingFiles.filter(file => file.startsWith('mcp-') && file.endsWith('.json'))\n        \n        if (mcpConfigFiles.length === 0) {\n          // æ²¡æœ‰å…¶ä»–MCPé…ç½®æ–‡ä»¶ï¼Œåˆ é™¤æ•´ä¸ªHashç›®å½•\n          await fs.remove(projectConfigDir)\n        }\n      } catch (error) {\n        // ç›®å½•å¯èƒ½å·²ç»è¢«åˆ é™¤ï¼Œå¿½ç•¥é”™è¯¯\n      }\n      \n      return true\n    }\n    \n    return false\n  }\n\n  /**\n   * æ¸…ç†è¿‡æœŸçš„é¡¹ç›®é…ç½® - æ”¯æŒHashç›®å½•ç»“æ„\n   * @returns {Promise<number>} æ¸…ç†çš„é…ç½®æ–‡ä»¶æ•°é‡\n   */\n  async cleanupExpiredProjects() {\n    if (!await fs.pathExists(this.projectsDir)) {\n      return 0\n    }\n\n    const hashDirs = await fs.readdir(this.projectsDir)\n    let cleanedCount = 0\n\n    for (const hashDir of hashDirs) {\n      const hashDirPath = path.join(this.projectsDir, hashDir)\n      \n      // åªå¤„ç†Hashç›®å½•\n      if (!(await fs.stat(hashDirPath)).isDirectory()) {\n        continue\n      }\n      \n      try {\n        const configFiles = await fs.readdir(hashDirPath)\n        let hasValidConfig = false\n        \n        for (const file of configFiles) {\n          if (file.startsWith('mcp-') && file.endsWith('.json')) {\n            try {\n              const configPath = path.join(hashDirPath, file)\n              const config = await fs.readJson(configPath)\n              \n              // æ£€æŸ¥é¡¹ç›®è·¯å¾„æ˜¯å¦ä»ç„¶å­˜åœ¨\n              if (!await fs.pathExists(config.projectPath)) {\n                await fs.remove(configPath)\n                cleanedCount++\n                logger.info(`æ¸…ç†è¿‡æœŸé¡¹ç›®é…ç½®: ${file}`)\n              } else {\n                hasValidConfig = true\n              }\n            } catch (error) {\n              // æ¸…ç†æŸåçš„é…ç½®æ–‡ä»¶\n              await fs.remove(path.join(hashDirPath, file))\n              cleanedCount++\n              logger.info(`æ¸…ç†æŸåé…ç½®æ–‡ä»¶: ${file}`)\n            }\n          }\n        }\n        \n        // å¦‚æœHashç›®å½•ä¸­æ²¡æœ‰æœ‰æ•ˆçš„é…ç½®æ–‡ä»¶ï¼Œåˆ é™¤æ•´ä¸ªç›®å½•\n        if (!hasValidConfig) {\n          await fs.remove(hashDirPath)\n          logger.info(`æ¸…ç†ç©ºçš„é¡¹ç›®Hashç›®å½•: ${hashDir}`)\n        }\n      } catch (error) {\n        // æ¸…ç†æ— æ³•è®¿é—®çš„ç›®å½•\n        await fs.remove(hashDirPath)\n        cleanedCount++\n        logger.info(`æ¸…ç†æ— æ³•è®¿é—®çš„ç›®å½•: ${hashDir}`)\n      }\n    }\n\n    return cleanedCount\n  }\n\n  /**\n   * ç”Ÿæˆå¤šé¡¹ç›®ç¯å¢ƒä¸‹çš„AIæç¤ºè¯\n   * @param {string} contextType - ä¸Šä¸‹æ–‡ç±»å‹ï¼š'list'/'action'/'learn'\n   * @param {string} mcpId - MCPè¿›ç¨‹ID\n   * @param {string} ideType - IDEç±»å‹\n   * @returns {Promise<string>} æ ¼å¼åŒ–çš„AIæç¤ºè¯\n   */\n  async generateTopLevelProjectPrompt(contextType = 'list', mcpId, ideType) {\n    const projects = await this.getProjectsByMcpId(mcpId)\n    \n    if (projects.length === 0) {\n      // æœªç»‘å®šé¡¹ç›®ï¼Œä½†è¿™æ˜¯æ­£å¸¸çš„ï¼Œä¸éœ€è¦ç‰¹åˆ«æç¤º\n      return ''\n    }\n    \n    if (projects.length === 1) {\n      // å•é¡¹ç›®ç¯å¢ƒï¼ˆä¿æŒç°æœ‰ä½“éªŒï¼‰\n      const project = projects[0]\n      const basePrompt = `ğŸ›‘ **é¡¹ç›®ç¯å¢ƒéªŒè¯** ğŸ›‘\nğŸ“ å½“å‰ç»‘å®šé¡¹ç›®: ${project.projectPath}\nğŸ”— MCPå®ä¾‹: ${mcpId} (${ideType})\n\nâš ï¸ **æ‰§è¡Œå‰ç¡®è®¤**ï¼šä¸Šè¿°è·¯å¾„æ˜¯å¦ä¸ºä½ å½“å‰å·¥ä½œçš„é¡¹ç›®ï¼Ÿ`\n\n      switch (contextType) {\n        case 'action':\n          return `${basePrompt}\nå¦‚ä¸ä¸€è‡´ï¼Œç«‹å³åœæ­¢æ‰€æœ‰æ“ä½œå¹¶ä½¿ç”¨ \\`promptx_init\\` æ›´æ–°ï¼\n\nğŸ’¥ **ä¸¥é‡è­¦å‘Š**ï¼šåœ¨é”™è¯¯é¡¹ç›®è·¯å¾„ä¸‹æ“ä½œå°†å¯¼è‡´ä¸å¯é¢„çŸ¥çš„é”™è¯¯ï¼`\n        \n        case 'learn':\n          return `${basePrompt}\né”™è¯¯ç¯å¢ƒå°†å¯¼è‡´çŸ¥è¯†å…³è”å¤±æ•ˆï¼\n\nğŸ’¥ **ä¸¥é‡è­¦å‘Š**ï¼šé¡¹ç›®ç¯å¢ƒä¸åŒ¹é…å°†å½±å“å­¦ä¹ æ•ˆæœï¼`\n        \n        default:\n          return `${basePrompt}\nå¦‚ä¸ä¸€è‡´ï¼Œå¿…é¡»ä½¿ç”¨ \\`promptx_init\\` æ›´æ–°æ­£ç¡®è·¯å¾„ï¼\n\nğŸ’¥ **ä¸¥é‡è­¦å‘Š**ï¼šé”™è¯¯çš„é¡¹ç›®ç¯å¢ƒå°†å¯¼è‡´æœåŠ¡å¼‚å¸¸ï¼`\n      }\n    }\n    \n    // å¤šé¡¹ç›®ç¯å¢ƒ\n    const projectList = projects.map((proj, index) => \n      `${index + 1}. ${path.basename(proj.projectPath)} (${proj.projectPath})`\n    ).join('\\n')\n    \n    return `ğŸ¯ **å¤šé¡¹ç›®ç¯å¢ƒæ£€æµ‹** ğŸ¯\nğŸ“ å½“å‰MCPå®ä¾‹(${mcpId})å·²ç»‘å®š ${projects.length} ä¸ªé¡¹ç›®ï¼š\n\n${projectList}\n\nâš ï¸ **è¯·æ˜ç¡®æŒ‡å®š**ï¼šä½ è¦åœ¨å“ªä¸ªé¡¹ç›®ä¸­æ‰§è¡Œæ“ä½œï¼Ÿ\nğŸ’¡ **å»ºè®®**ï¼šåœ¨å¯¹è¯ä¸­æ˜ç¡®è¯´æ˜é¡¹ç›®åç§°æˆ–è·¯å¾„`\n  }\n\n  /**\n   * éªŒè¯è·¯å¾„æ˜¯å¦ä¸ºæœ‰æ•ˆçš„é¡¹ç›®ç›®å½•\n   * @param {string} projectPath - è¦éªŒè¯çš„è·¯å¾„\n   * @returns {Promise<boolean>} æ˜¯å¦ä¸ºæœ‰æ•ˆé¡¹ç›®ç›®å½•\n   */\n  async validateProjectPath(projectPath) {\n    try {\n      // åŸºç¡€æ£€æŸ¥ï¼šè·¯å¾„å­˜åœ¨ä¸”ä¸ºç›®å½•\n      const stat = await fs.stat(projectPath)\n      if (!stat.isDirectory()) {\n        return false\n      }\n\n      // ç®€å•æ£€æŸ¥ï¼šé¿å…æ˜æ˜¾é”™è¯¯çš„è·¯å¾„\n      const resolved = path.resolve(projectPath)\n      const homeDir = os.homedir()\n      \n      // ä¸å…è®¸æ˜¯ç”¨æˆ·ä¸»ç›®å½•\n      if (resolved === homeDir) {\n        return false\n      }\n\n      return true\n    } catch (error) {\n      return false\n    }\n  }\n\n  /**\n   * ç”Ÿæˆé…ç½®æ–‡ä»¶å\n   * @param {string} mcpId - MCPè¿›ç¨‹ID\n   * @param {string} ideType - IDEç±»å‹\n   * @param {string} transport - ä¼ è¾“åè®®ç±»å‹\n   * @param {string} projectPath - é¡¹ç›®è·¯å¾„\n   * @returns {string} é…ç½®æ–‡ä»¶å\n   */\n  generateConfigFileName(mcpId, ideType, transport, projectPath) {\n    const projectHash = this.generateProjectHash(projectPath)\n    const projectName = path.basename(projectPath).toLowerCase().replace(/[^a-z0-9-]/g, '-')\n    const ideTypeSafe = ideType.replace(/[^a-z0-9-]/g, '').toLowerCase() || 'unknown'\n    const transportSafe = transport.replace(/[^a-z0-9-]/g, '').toLowerCase() || 'unknown'\n    // æ ¼å¼ï¼šmcp-transport-id-idetype-projectname-hash.json\n    return `mcp-${transportSafe}-${mcpId.replace('mcp-', '')}-${ideTypeSafe}-${projectName}-${projectHash}.json`\n  }\n\n  /**\n   * ç”Ÿæˆé¡¹ç›®è·¯å¾„çš„Hashå€¼\n   * @param {string} projectPath - é¡¹ç›®è·¯å¾„\n   * @returns {string} 8ä½Hashå€¼\n   */\n  generateProjectHash(projectPath) {\n    return crypto.createHash('md5').update(path.resolve(projectPath)).digest('hex').substr(0, 8)\n  }\n\n  /**\n   * ä»é…ç½®æ–‡ä»¶ä¸­è·å–IDEç±»å‹\n   * @param {string} mcpId - MCPè¿›ç¨‹ID\n   * @returns {Promise<string>} IDEç±»å‹\n   */\n  async getIdeType(mcpId) {\n    const project = await this.getProjectByMcpId(mcpId)\n    return project ? project.ideType : 'unknown'\n  }\n\n  /**\n   * ç”ŸæˆMCPè¿›ç¨‹ID - åŸºäºè¿›ç¨‹IDç¡®ä¿å®ä¾‹å”¯ä¸€\n   * @param {string} ideType - IDEç±»å‹ï¼ˆä¿ç•™å‚æ•°å…¼å®¹æ€§ï¼Œå®é™…ä¸ä½¿ç”¨ï¼‰\n   * @returns {string} MCPè¿›ç¨‹ID\n   */\n  static generateMcpId(ideType = 'unknown') {\n    const serverEnv = getGlobalServerEnvironment()\n    if (serverEnv.isInitialized()) {\n      return serverEnv.getMcpId()\n    }\n    // fallbackåˆ°åŸé€»è¾‘\n    return `mcp-${process.pid}`\n  }\n\n  /**\n   * ç»Ÿä¸€é¡¹ç›®æ³¨å†Œæ–¹æ³• - æ–°æ¶æ„ï¼šè®¾ç½®å½“å‰é¡¹ç›®å¹¶æŒä¹…åŒ–é…ç½®\n   * @param {string} workingDirectory - é¡¹ç›®å·¥ä½œç›®å½•\n   * @param {string} ideType - IDEç±»å‹ï¼ˆå¯é€‰ï¼Œé»˜è®¤'unknown'ï¼‰\n   * @returns {Promise<Object>} é¡¹ç›®é…ç½®å¯¹è±¡\n   */\n  static async registerCurrentProject(workingDirectory, ideType = 'unknown') {\n    logger.debug(`[ProjectManager DEBUG] ======= registerCurrentProjectå¼€å§‹ =======`)\n    logger.debug(`[ProjectManager DEBUG] å‚æ•° - workingDirectory: ${workingDirectory}`)\n    logger.debug(`[ProjectManager DEBUG] å‚æ•° - ideType: ${ideType}`)\n    logger.debug(`[ProjectManager DEBUG] æ³¨å†Œå‰ currentProjectçŠ¶æ€:`, JSON.stringify(this.currentProject, null, 2))\n    \n    const serverEnv = getGlobalServerEnvironment()\n    if (!serverEnv.isInitialized()) {\n      logger.error(`[ProjectManager DEBUG] âŒ ServerEnvironmentæœªåˆå§‹åŒ–`)\n      throw new Error('ServerEnvironment not initialized')\n    }\n    \n    const mcpId = serverEnv.getMcpId()\n    const transport = serverEnv.getTransport()\n    logger.debug(`[ProjectManager DEBUG] ServerEnvironmentä¿¡æ¯ - mcpId: ${mcpId}, transport: ${transport}`)\n    \n    // ğŸ¯ æ–°æ¶æ„ï¼šè®¾ç½®å½“å‰é¡¹ç›®çŠ¶æ€\n    logger.debug(`[ProjectManager DEBUG] è°ƒç”¨ setCurrentProject...`)\n    this.setCurrentProject(workingDirectory, mcpId, ideType, transport)\n    logger.debug(`[ProjectManager DEBUG] setCurrentProjectå®Œæˆå currentProjectçŠ¶æ€:`, JSON.stringify(this.currentProject, null, 2))\n    \n    // æŒä¹…åŒ–é¡¹ç›®é…ç½®ï¼ˆä¿æŒå¤šé¡¹ç›®ç®¡ç†åŠŸèƒ½ï¼‰\n    logger.debug(`[ProjectManager DEBUG] å¼€å§‹æŒä¹…åŒ–é¡¹ç›®é…ç½®...`)\n    const projectManager = getGlobalProjectManager()\n    const result = await projectManager.registerProject(workingDirectory, mcpId, ideType, transport)\n    logger.debug(`[ProjectManager DEBUG] é¡¹ç›®é…ç½®æŒä¹…åŒ–å®Œæˆ:`, JSON.stringify(result, null, 2))\n    logger.debug(`[ProjectManager DEBUG] ======= registerCurrentProjectç»“æŸ =======`)\n    \n    return result\n  }\n}\n\n// åˆ›å»ºå…¨å±€å•ä¾‹å®ä¾‹\nlet globalProjectManager = null\n\n/**\n * è·å–å…¨å±€ProjectManagerå•ä¾‹\n * @returns {ProjectManager} å…¨å±€ProjectManagerå®ä¾‹\n */\nfunction getGlobalProjectManager() {\n  if (!globalProjectManager) {\n    globalProjectManager = new ProjectManager()\n  }\n  return globalProjectManager\n}\n\nmodule.exports = ProjectManager\nmodule.exports.ProjectManager = ProjectManager\nmodule.exports.getGlobalProjectManager = getGlobalProjectManager","const path = require('path')\nconst ProjectManager = require('./ProjectManager')\n\n/**\n * é¡¹ç›®è·¯å¾„è§£æå™¨ - æ–°æ¶æ„\n * è½»é‡çº§çš„@projectåè®®è·¯å¾„è§£æï¼ŒåŸºäºå½“å‰é¡¹ç›®çŠ¶æ€\n * æ›¿ä»£å¤æ‚çš„.promptxç›®å½•æŸ¥æ‰¾é€»è¾‘\n */\nclass ProjectPathResolver {\n  constructor() {\n    // æ”¯æŒçš„é¡¹ç›®ç»“æ„ç›®å½•æ˜ å°„\n    this.projectDirs = {\n      root: '', // é¡¹ç›®æ ¹ç›®å½•\n      src: 'src', // æºä»£ç ç›®å½•\n      lib: 'lib', // åº“ç›®å½•\n      build: 'build', // æ„å»ºè¾“å‡ºç›®å½•\n      dist: 'dist', // åˆ†å‘ç›®å½•\n      docs: 'docs', // æ–‡æ¡£ç›®å½•\n      test: 'test', // æµ‹è¯•ç›®å½•\n      tests: 'tests', // æµ‹è¯•ç›®å½•ï¼ˆå¤æ•°ï¼‰\n      spec: 'spec', // è§„èŒƒæµ‹è¯•ç›®å½•\n      config: 'config', // é…ç½®ç›®å½•\n      scripts: 'scripts', // è„šæœ¬ç›®å½•\n      assets: 'assets', // èµ„æºç›®å½•\n      public: 'public', // å…¬å…±èµ„æºç›®å½•\n      static: 'static', // é™æ€èµ„æºç›®å½•\n      templates: 'templates', // æ¨¡æ¿ç›®å½•\n      examples: 'examples', // ç¤ºä¾‹ç›®å½•\n      tools: 'tools', // å·¥å…·ç›®å½•\n      '.promptx': '.promptx' // PromptXé…ç½®ç›®å½•\n    }\n  }\n\n  /**\n   * è§£æ@project://åè®®è·¯å¾„\n   * @param {string} resourcePath - èµ„æºè·¯å¾„ï¼Œå¦‚ \"src/index.js\" æˆ– \".promptx/resource/...\"\n   * @returns {string} è§£æåçš„ç»å¯¹è·¯å¾„\n   */\n  resolvePath(resourcePath) {\n    // ğŸ¯ æ–°æ¶æ„ï¼šç›´æ¥è·å–å½“å‰é¡¹ç›®è·¯å¾„ï¼Œæ— éœ€æŸ¥æ‰¾\n    const projectRoot = ProjectManager.getCurrentProjectPath()\n    \n    // ç‰¹æ®Šå¤„ç†ï¼š.promptxå¼€å¤´çš„è·¯å¾„ç›´æ¥ç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•\n    if (resourcePath.startsWith('.promptx/')) {\n      const fullPath = path.join(projectRoot, resourcePath)\n      return this._validatePath(fullPath, projectRoot)\n    }\n\n    // æ ‡å‡†è·¯å¾„å¤„ç†é€»è¾‘\n    const parts = resourcePath.split('/')\n    const dirType = parts[0]\n    const relativePath = parts.slice(1).join('/')\n\n    // éªŒè¯ç›®å½•ç±»å‹\n    if (!this.projectDirs.hasOwnProperty(dirType)) {\n      throw new Error(`ä¸æ”¯æŒçš„é¡¹ç›®ç›®å½•ç±»å‹: ${dirType}ã€‚æ”¯æŒçš„ç±»å‹: ${Object.keys(this.projectDirs).join(', ')}`)\n    }\n\n    // æ„å»ºç›®æ ‡ç›®å½•è·¯å¾„\n    const projectDirPath = this.projectDirs[dirType]\n    const targetDir = projectDirPath ? path.join(projectRoot, projectDirPath) : projectRoot\n\n    // å¦‚æœæ²¡æœ‰ç›¸å¯¹è·¯å¾„ï¼Œè¿”å›ç›®å½•æœ¬èº«\n    if (!relativePath) {\n      return targetDir\n    }\n\n    // æ‹¼æ¥å®Œæ•´è·¯å¾„\n    const fullPath = path.join(targetDir, relativePath)\n    return this._validatePath(fullPath, projectRoot)\n  }\n\n  /**\n   * è·å–é¡¹ç›®æ ¹ç›®å½•\n   * @returns {string} å½“å‰é¡¹ç›®æ ¹ç›®å½•\n   */\n  getProjectRoot() {\n    return ProjectManager.getCurrentProjectPath()\n  }\n\n  /**\n   * è·å–PromptXé…ç½®ç›®å½•è·¯å¾„\n   * @returns {string} .promptxç›®å½•è·¯å¾„\n   */\n  getPromptXDirectory() {\n    const projectRoot = ProjectManager.getCurrentProjectPath()\n    return path.join(projectRoot, '.promptx')\n  }\n\n  /**\n   * è·å–é¡¹ç›®èµ„æºç›®å½•è·¯å¾„\n   * @returns {string} é¡¹ç›®èµ„æºç›®å½•è·¯å¾„\n   */\n  getResourceDirectory() {\n    const promptxDir = this.getPromptXDirectory()\n    return path.join(promptxDir, 'resource')\n  }\n\n  /**\n   * è·å–é¡¹ç›®æ³¨å†Œè¡¨æ–‡ä»¶è·¯å¾„\n   * @returns {string} æ³¨å†Œè¡¨æ–‡ä»¶è·¯å¾„\n   */\n  getRegistryPath() {\n    const resourceDir = this.getResourceDirectory()\n    return path.join(resourceDir, 'project.registry.json')\n  }\n\n  /**\n   * è·å–è®°å¿†ç›®å½•è·¯å¾„\n   * @returns {string} è®°å¿†ç›®å½•è·¯å¾„\n   */\n  getMemoryDirectory() {\n    const promptxDir = this.getPromptXDirectory()\n    return path.join(promptxDir, 'memory')\n  }\n\n  /**\n   * éªŒè¯è·¯å¾„å®‰å…¨æ€§\n   * @param {string} fullPath - å®Œæ•´è·¯å¾„\n   * @param {string} projectRoot - é¡¹ç›®æ ¹ç›®å½•\n   * @returns {string} éªŒè¯åçš„è·¯å¾„\n   * @private\n   */\n  _validatePath(fullPath, projectRoot) {\n    // å®‰å…¨æ£€æŸ¥ï¼šç¡®ä¿è·¯å¾„åœ¨é¡¹ç›®ç›®å½•å†…\n    const resolvedPath = path.resolve(fullPath)\n    const resolvedProjectRoot = path.resolve(projectRoot)\n\n    if (!resolvedPath.startsWith(resolvedProjectRoot)) {\n      throw new Error(`å®‰å…¨é”™è¯¯ï¼šè·¯å¾„è¶…å‡ºé¡¹ç›®ç›®å½•èŒƒå›´: ${resolvedPath}`)\n    }\n\n    return resolvedPath\n  }\n\n  /**\n   * è·å–æ”¯æŒçš„ç›®å½•ç±»å‹\n   * @returns {Array<string>} æ”¯æŒçš„ç›®å½•ç±»å‹åˆ—è¡¨\n   */\n  getSupportedDirectories() {\n    return Object.keys(this.projectDirs)\n  }\n\n  /**\n   * æ£€æŸ¥ç›®å½•ç±»å‹æ˜¯å¦æ”¯æŒ\n   * @param {string} dirType - ç›®å½•ç±»å‹\n   * @returns {boolean} æ˜¯å¦æ”¯æŒ\n   */\n  isSupportedDirectory(dirType) {\n    return this.projectDirs.hasOwnProperty(dirType)\n  }\n}\n\n// åˆ›å»ºå…¨å±€å•ä¾‹å®ä¾‹\nlet globalProjectPathResolver = null\n\n/**\n * è·å–å…¨å±€ProjectPathResolverå•ä¾‹\n * @returns {ProjectPathResolver} å…¨å±€ProjectPathResolverå®ä¾‹\n */\nfunction getGlobalProjectPathResolver() {\n  if (!globalProjectPathResolver) {\n    globalProjectPathResolver = new ProjectPathResolver()\n  }\n  return globalProjectPathResolver\n}\n\nmodule.exports = ProjectPathResolver\nmodule.exports.getGlobalProjectPathResolver = getGlobalProjectPathResolver","const path = require('path');\nconst fs = require('fs').promises;\nconst { spawn } = require('child_process');\nconst vm = require('vm');\nconst SandboxIsolationManager = require('./SandboxIsolationManager');\nconst SandboxErrorManager = require('./SandboxErrorManager');\nconst ToolDirectoryManager = require('./ToolDirectoryManager');\nconst ESModuleRequireSupport = require('./ESModuleRequireSupport');\nconst logger = require('@promptx/logger');\n\n/**\n * ToolSandbox - å·¥å…·æ²™ç®±ç¯å¢ƒç®¡ç†å™¨\n * \n * åŸºäºç°æœ‰åè®®ç³»ç»Ÿçš„å·¥å…·æ‰§è¡Œç¯å¢ƒï¼Œæ”¯æŒï¼š\n * - @tool:// åè®®å®šä½å·¥å…·\n * - @user://.promptx/toolbox æ²™ç®±éš”ç¦»\n * - è‡ªåŠ¨ä¾èµ–ç®¡ç†\n * - å¯å¤ç”¨çš„æ‰§è¡Œç¯å¢ƒ\n */\nclass ToolSandbox {\n  constructor(toolReference, options = {}) {\n    this.toolReference = toolReference;  // @tool://url-validator\n    this.resourceManager = null;         // ResourceManagerå®ä¾‹\n    this.toolId = null;                  // å·¥å…·IDï¼Œå¦‚ url-validator\n    this.toolContent = null;             // å·¥å…·æ–‡ä»¶å†…å®¹\n    this.toolInstance = null;            // å·¥å…·å®ä¾‹\n    this.dependencies = [];              // ä¾èµ–åˆ—è¡¨\n    this.directoryManager = null;        // ç›®å½•ç®¡ç†å™¨ï¼ˆæ–°å¢ï¼‰\n    this.sandboxPath = null;             // æ²™ç®±ç›®å½•è·¯å¾„ï¼ˆä¿ç•™ç”¨äºå…¼å®¹ï¼‰\n    this.sandboxContext = null;          // VMæ²™ç®±ä¸Šä¸‹æ–‡\n    this.isolationManager = null;        // æ²™ç®±éš”ç¦»ç®¡ç†å™¨\n    this.errorManager = new SandboxErrorManager(); // æ™ºèƒ½é”™è¯¯ç®¡ç†å™¨\n    this.esModuleSupport = null;         // ES Module æ”¯æŒå™¨\n    \n    // çŠ¶æ€æ ‡å¿—\n    this.isAnalyzed = false;\n    this.isPrepared = false;\n    \n    // é…ç½®é€‰é¡¹\n    this.options = {\n      timeout: 30000,\n      enableDependencyInstall: true,\n      rebuild: false,  // å¼ºåˆ¶é‡å»ºæ²™ç®±ï¼ˆç”¨äºå¤„ç†å¼‚å¸¸æƒ…å†µï¼‰\n      ...options\n    };\n  }\n\n  /**\n   * è®¾ç½®ResourceManagerå®ä¾‹\n   * @param {ResourceManager} resourceManager \n   */\n  setResourceManager(resourceManager) {\n    this.resourceManager = resourceManager;\n  }\n\n  /**\n   * æ¸…ç†æ²™ç®±çŠ¶æ€å’Œç¼“å­˜\n   * @param {boolean} deleteDirectory - æ˜¯å¦åˆ é™¤æ²™ç®±ç›®å½•\n   */\n  async clearSandbox(deleteDirectory = false) {\n    logger.debug(`[ToolSandbox] Clearing sandbox state${deleteDirectory ? ' and deleting directory' : ''}`);\n    \n    // æ¸…ç©ºæ‰€æœ‰ç¼“å­˜å’ŒçŠ¶æ€\n    this.isAnalyzed = false;\n    this.isPrepared = false;\n    this.toolContent = null;\n    this.toolInstance = null;\n    this.dependencies = [];\n    this.sandboxContext = null;\n    \n    // å¦‚æœéœ€è¦ï¼Œåˆ é™¤æ²™ç®±ç›®å½•\n    if (deleteDirectory && this.directoryManager) {\n      try {\n        await this.directoryManager.deleteToolbox();\n      } catch (error) {\n        logger.debug(`[ToolSandbox] Error deleting toolbox directory (can be ignored): ${error.message}`);\n      }\n    }\n  }\n\n  /**\n   * åˆ†æå·¥å…·ï¼šåŠ è½½å·¥å…·å†…å®¹ï¼Œæå–å…ƒä¿¡æ¯å’Œä¾èµ–\n   * @returns {Promise<Object>} åˆ†æç»“æœ\n   */\n  async analyze() {\n    if (this.isAnalyzed && !this.options.rebuild) {\n      logger.debug(`[ToolSandbox] Using cached analysis result, dependencies: ${JSON.stringify(this.dependencies)}`);\n      return this.getAnalysisResult();\n    }\n\n    if (!this.resourceManager) {\n      throw new Error('ResourceManager not set. Call setResourceManager() first.');\n    }\n\n    try {\n      // 1. è§£æå·¥å…·å¼•ç”¨ï¼Œæå–å·¥å…·ID\n      this.toolId = this.extractToolId(this.toolReference);\n      \n      // 2. é€šè¿‡åè®®ç³»ç»ŸåŠ è½½å·¥å…·ï¼ˆforceReinstallæ—¶å¼ºåˆ¶é‡æ–°åŠ è½½ï¼‰\n      const loadOptions = this.options.forceReinstall ? { noCache: true } : {};\n      logger.debug(`[ToolSandbox] Loading tool ${this.toolReference}, options:`, loadOptions);\n      \n      const toolResult = await this.resourceManager.loadResource(this.toolReference, loadOptions);\n      if (!toolResult.success) {\n        // è°ƒè¯•ï¼šå°è¯•ä¸åŒçš„æŸ¥æ‰¾æ–¹å¼\n        logger.debug(`[ToolSandbox] Debug: Trying to find tool ${this.toolReference}`);\n        const directLookup = this.resourceManager.registryData.findResourceById(`tool:${this.toolId}`, 'tool');\n        logger.debug(`[ToolSandbox]    - Direct lookup tool:${this.toolId}: ${directLookup ? 'found' : 'not found'}`);\n        \n        throw new Error(`Failed to load tool: ${toolResult.error.message}`);\n      }\n      \n      this.toolContent = toolResult.content;\n      \n      // è°ƒè¯•ï¼šæ£€æŸ¥åŠ è½½çš„å·¥å…·å†…å®¹\n      logger.debug(`[ToolSandbox] Loaded tool content first 200 chars:`, this.toolContent.substring(0, 200));\n      \n      // 3. åˆå§‹åŒ–ç›®å½•ç®¡ç†å™¨\n      this.directoryManager = new ToolDirectoryManager(this.toolId, this.resourceManager);\n      await this.directoryManager.initialize();\n      await this.directoryManager.ensureDirectories();\n      \n      // 4. è®¾ç½® sandboxPath ç”¨äºå…¼å®¹\n      this.sandboxPath = this.directoryManager.getWorkingPath();\n      \n      // 5. åœ¨åŸºç¡€æ²™ç®±ä¸­åˆ†æå·¥å…·\n      await this.analyzeToolInSandbox();\n      \n      this.isAnalyzed = true;\n      return this.getAnalysisResult();\n      \n    } catch (error) {\n      throw new Error(`Tool analysis failed: ${error.message}`);\n    }\n  }\n\n  /**\n   * å‡†å¤‡ä¾èµ–ï¼šå®‰è£…ä¾èµ–ï¼Œå‡†å¤‡æ‰§è¡Œç¯å¢ƒ\n   * @returns {Promise<Object>} å‡†å¤‡ç»“æœ\n   */\n  async prepareDependencies() {\n    logger.info(`[ToolSandbox] Starting prepareDependencies for tool ${this.toolId}`);\n    \n    // å¤„ç†rebuildé€‰é¡¹\n    if (this.options.rebuild) {\n      logger.info(`[ToolSandbox] Manually triggering sandbox rebuild`);\n      await this.clearSandbox(true);\n      // é‡æ–°åˆå§‹åŒ–ç›®å½•ç®¡ç†å™¨\n      if (this.directoryManager) {\n        await this.directoryManager.initialize();\n      }\n    }\n    \n    // åˆ†æå·¥å…·ï¼ˆå¦‚æœéœ€è¦ï¼‰\n    if (!this.isAnalyzed) {\n      logger.info(`[ToolSandbox] Starting tool analysis`);\n      await this.analyze();\n      logger.info(`[ToolSandbox] Tool analysis completed`);\n    }\n    \n    // è‡ªåŠ¨æ£€æµ‹ä¾èµ–æ˜¯å¦éœ€è¦æ›´æ–°\n    if (!this.options.rebuild && await this.checkDependenciesNeedUpdate()) {\n      logger.debug(`[ToolSandbox] Dependency changes detected, auto-rebuilding sandbox`);\n      await this.clearSandbox(true);\n      // é‡æ–°åˆ†æä»¥è·å–æœ€æ–°ä¾èµ–\n      await this.analyze();\n    }\n    \n    if (this.isPrepared) {\n      return { success: true, message: 'Dependencies already prepared' };\n    }\n\n    try {\n      // 1. ç¡®ä¿æ²™ç®±ç›®å½•å­˜åœ¨\n      await this.ensureSandboxDirectory();\n      \n      // 2. å¦‚æœæœ‰ä¾èµ–ï¼Œå®‰è£…å®ƒä»¬\n      const hasDependencies = typeof this.dependencies === 'object' && !Array.isArray(this.dependencies) \n        ? Object.keys(this.dependencies).length > 0\n        : this.dependencies.length > 0;\n        \n      if (hasDependencies) {\n        logger.info(`[ToolSandbox] Installing dependencies`);\n        await this.installDependencies();\n        logger.info(`[ToolSandbox] Dependencies installation completed`);\n        \n        // 2.1 æ£€æµ‹ ES Module ä¾èµ–\n        await this.detectAndHandleESModules();\n      }\n      \n      // 3. åˆ›å»ºæ‰§è¡Œæ²™ç®±ç¯å¢ƒ\n      logger.info(`[ToolSandbox] Creating execution sandbox`);\n      await this.createExecutionSandbox();\n      logger.info(`[ToolSandbox] Execution sandbox created`);\n      \n      this.isPrepared = true;\n      return { \n        success: true, \n        sandboxPath: this.directoryManager.getWorkingPath(),\n        toolboxPath: this.directoryManager.getToolboxPath(),\n        dependencies: this.dependencies \n      };\n      \n    } catch (error) {\n      throw new Error(`Dependency preparation failed: ${error.message}`);\n    }\n  }\n\n  /**\n   * æ‰§è¡Œå·¥å…·\n   * @param {Object} parameters - å·¥å…·å‚æ•°\n   * @returns {Promise<Object>} æ‰§è¡Œç»“æœ\n   */\n  async execute(parameters = {}) {\n    const startTime = Date.now();\n    logger.info(`[ToolSandbox] Executing tool \"${this.toolId}\" with params: ${JSON.stringify(parameters)}`);\n    \n    if (!this.isPrepared) {\n      logger.debug(`[ToolSandbox] Preparing dependencies for tool ${this.toolId}`);\n      await this.prepareDependencies();\n    }\n\n    try {\n      // 1. å‚æ•°éªŒè¯\n      await this.validateParameters(parameters);\n      \n      // 2. åœ¨æ²™ç®±ä¸­æ‰§è¡Œå·¥å…·\n      const result = await this.executeInSandbox(parameters);\n      \n      const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);\n      logger.info(`[ToolSandbox] Tool \"${this.toolId}\" executed successfully in ${elapsed}s, result type: ${typeof result}`);\n      \n      return {\n        success: true,\n        data: result,\n        metadata: {\n          toolId: this.toolId,\n          sandboxPath: this.directoryManager.getWorkingPath(),\n          toolboxPath: this.directoryManager.getToolboxPath(),\n          executionTime: Date.now()\n        }\n      };\n      \n    } catch (error) {\n      // ä½¿ç”¨æ™ºèƒ½é”™è¯¯ç®¡ç†å™¨åˆ†æé”™è¯¯\n      const intelligentError = this.errorManager.analyzeError(error, {\n        toolId: this.toolId,\n        dependencies: this.dependencies,\n        sandboxPath: this.directoryManager?.getWorkingPath(),\n        toolboxPath: this.directoryManager?.getToolboxPath(),\n        phase: 'execute'\n      });\n      \n      // æŠ›å‡ºå¢å¼ºçš„é”™è¯¯å¯¹è±¡ï¼Œä¾›ä¸Šå±‚å¤„ç†è‡ªåŠ¨é‡è¯•\n      const enhancedError = new Error(intelligentError.formattedMessage);\n      enhancedError.intelligentError = intelligentError;\n      enhancedError.originalError = error;\n      throw enhancedError;\n    }\n  }\n\n  /**\n   * æå–å·¥å…·ID\n   * @param {string} toolReference - @tool://url-validator\n   * @returns {string} å·¥å…·ID\n   */\n  extractToolId(toolReference) {\n    const match = toolReference.match(/^@tool:\\/\\/(.+)$/);\n    if (!match) {\n      throw new Error(`Invalid tool reference format: ${toolReference}`);\n    }\n    return match[1];\n  }\n\n\n  /**\n   * åœ¨åŸºç¡€æ²™ç®±ä¸­åˆ†æå·¥å…·\n   */\n  async analyzeToolInSandbox() {\n    // åˆ›å»ºåˆ†æé˜¶æ®µçš„éš”ç¦»ç®¡ç†å™¨ï¼Œä½¿ç”¨å·¥ä½œç›®å½•\n    this.isolationManager = new SandboxIsolationManager(this.directoryManager.getWorkingPath(), {\n      enableDependencyLoading: false,\n      analysisMode: true\n    });\n    \n    const sandbox = this.isolationManager.createIsolatedContext();\n    \n    // è°ƒè¯•ï¼šæ£€æŸ¥å³å°†æ‰§è¡Œçš„ä»£ç \n    logger.debug(`[ToolSandbox] Tool code getDependencies section:`, \n      this.toolContent.match(/getDependencies[\\s\\S]*?return[\\s\\S]*?\\]/)?.[0] || 'getDependencies not found');\n    \n    const script = new vm.Script(this.toolContent, { filename: `${this.toolId}.js` });\n    const context = vm.createContext(sandbox);\n    \n    try {\n      script.runInContext(context);\n    } catch (error) {\n      // ä½¿ç”¨æ™ºèƒ½é”™è¯¯è¿‡æ»¤å¤„ç†requireé”™è¯¯\n      const filteredError = this._filterRequireError(error);\n      if (filteredError) {\n        throw filteredError;\n      }\n      // å¦‚æœæ˜¯é¢„æœŸçš„requireé”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œ\n    }\n    \n    const exported = context.module.exports;\n    \n    if (!exported) {\n      throw new Error(`Tool does not export anything: ${this.toolId}`);\n    }\n    \n    // åˆ›å»ºå·¥å…·å®ä¾‹\n    let toolInstance;\n    if (typeof exported === 'function') {\n      toolInstance = new exported();\n    } else if (typeof exported === 'object') {\n      toolInstance = exported;\n    } else {\n      throw new Error(`Invalid tool export format: ${this.toolId}`);\n    }\n    \n    // æå–ä¾èµ–\n    if (typeof toolInstance.getDependencies === 'function') {\n      try {\n        this.dependencies = toolInstance.getDependencies() || {};\n        logger.debug(`[ToolSandbox] Extracted dependencies: ${JSON.stringify(this.dependencies)}`);\n      } catch (error) {\n        logger.warn(`[ToolSandbox] Failed to get dependencies for ${this.toolId}: ${error.message}`);\n        this.dependencies = {};\n      }\n    } else {\n      logger.debug(`[ToolSandbox] Tool does not have getDependencies method`);\n      this.dependencies = {};\n    }\n    \n    this.toolInstance = toolInstance;\n  }\n\n  /**\n   * æ™ºèƒ½è¿‡æ»¤requireé”™è¯¯\n   * @param {Error} error - æ•è·çš„é”™è¯¯\n   * @returns {Error|null} - å¦‚æœæ˜¯çœŸæ­£çš„é”™è¯¯åˆ™è¿”å›Errorå¯¹è±¡ï¼Œå¦‚æœæ˜¯é¢„æœŸçš„requireé”™è¯¯åˆ™è¿”å›null\n   * @private\n   */\n  _filterRequireError(error) {\n    // æ£€æŸ¥æ˜¯å¦æ˜¯MODULE_NOT_FOUNDé”™è¯¯\n    if (error.code === 'MODULE_NOT_FOUND') {\n      const missingModule = this._extractMissingModuleName(error.message);\n      \n      if (missingModule) {\n        // è·å–å·²å£°æ˜çš„ä¾èµ–åˆ—è¡¨\n        const declaredDependencies = this._extractDeclaredDependencies();\n        \n        // æ£€æŸ¥ç¼ºå¤±çš„æ¨¡å—æ˜¯å¦åœ¨ä¾èµ–å£°æ˜ä¸­\n        if (this._isDeclaredInDependencies(missingModule, declaredDependencies)) {\n          logger.debug(`[ToolSandbox] Dependency ${missingModule} not installed, will install in prepareDependencies phase`);\n          return null; // é¢„æœŸçš„é”™è¯¯ï¼Œå¿½ç•¥\n        } else {\n          return new Error(`æœªå£°æ˜çš„ä¾èµ–: ${missingModule}ï¼Œè¯·åœ¨getDependencies()ä¸­æ·»åŠ æ­¤ä¾èµ–`);\n        }\n      }\n    }\n    \n    // å…¶ä»–é”™è¯¯ç›´æ¥è¿”å›\n    return error;\n  }\n\n  /**\n   * ä»é”™è¯¯ä¿¡æ¯ä¸­æå–ç¼ºå¤±çš„æ¨¡å—å\n   * @param {string} errorMessage - é”™è¯¯ä¿¡æ¯\n   * @returns {string|null} - æ¨¡å—åæˆ–null\n   * @private\n   */\n  _extractMissingModuleName(errorMessage) {\n    // åŒ¹é… \"Cannot find module 'moduleName'\" æˆ– \"Cannot resolve module 'moduleName'\"\n    const match = errorMessage.match(/Cannot (?:find|resolve) module ['\"]([^'\"]+)['\"]/);\n    return match ? match[1] : null;\n  }\n\n  /**\n   * å°è¯•ä»å·¥å…·ä»£ç ä¸­æå–å·²å£°æ˜çš„ä¾èµ–\n   * @returns {string[]} - ä¾èµ–åˆ—è¡¨\n   * @private\n   */\n  _extractDeclaredDependencies() {\n    try {\n      // å°è¯•é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ä»ä»£ç ä¸­æå–getDependenciesçš„è¿”å›å€¼\n      const dependencyMatch = this.toolContent.match(/getDependencies\\s*\\(\\s*\\)\\s*\\{[\\s\\S]*?return\\s*\\[([\\s\\S]*?)\\]/);\n      \n      if (dependencyMatch) {\n        const dependencyString = dependencyMatch[1];\n        // æå–å­—ç¬¦ä¸²å­—é¢é‡\n        const stringMatches = dependencyString.match(/['\"]([^'\"]+)['\"]/g);\n        if (stringMatches) {\n          return stringMatches.map(str => str.slice(1, -1)); // å»æ‰å¼•å·\n        }\n      }\n    } catch (error) {\n      logger.warn(`[ToolSandbox] Unable to parse dependency declaration: ${error.message}`);\n    }\n    \n    return [];\n  }\n\n  /**\n   * æ£€æŸ¥æ¨¡å—æ˜¯å¦åœ¨ä¾èµ–å£°æ˜ä¸­\n   * @param {string} moduleName - æ¨¡å—å\n   * @param {string[]} declaredDependencies - å·²å£°æ˜çš„ä¾èµ–åˆ—è¡¨\n   * @returns {boolean} - æ˜¯å¦å·²å£°æ˜\n   * @private\n   */\n  _isDeclaredInDependencies(moduleName, declaredDependencies) {\n    return declaredDependencies.some(dep => {\n      // æ”¯æŒ \"axios@^1.6.0\" æ ¼å¼ï¼Œæå–æ¨¡å—åéƒ¨åˆ†\n      const depName = dep.split('@')[0];\n      return depName === moduleName;\n    });\n  }\n\n  /**\n   * æ£€æŸ¥æ²™ç®±ç›®å½•æ˜¯å¦å­˜åœ¨\n   * @returns {Promise<boolean>}\n   */\n  async sandboxExists() {\n    if (!this.directoryManager) {\n      return false;\n    }\n    return await this.directoryManager.toolboxExists();\n  }\n\n  /**\n   * ç¡®ä¿æ²™ç®±ç›®å½•å­˜åœ¨\n   */\n  async ensureSandboxDirectory() {\n    // å§”æ‰˜ç»™ directoryManager å¤„ç†\n    if (this.directoryManager) {\n      await this.directoryManager.ensureDirectories();\n    }\n  }\n\n  /**\n   * å®‰è£…ä¾èµ–\n   */\n  async installDependencies() {\n    // æ£€æŸ¥ä¾èµ–æ˜¯å¦ä¸ºç©ºï¼ˆæ”¯æŒå¯¹è±¡å’Œæ•°ç»„æ ¼å¼ï¼‰\n    const hasDependencies = typeof this.dependencies === 'object' && !Array.isArray(this.dependencies) \n      ? Object.keys(this.dependencies).length > 0\n      : this.dependencies.length > 0;\n      \n    if (!hasDependencies) {\n      return;\n    }\n\n    // 1. åˆ›å»ºpackage.json\n    await this.createPackageJson();\n    \n    // 2. ä½¿ç”¨å†…ç½®pnpmå®‰è£…ä¾èµ–\n    await this.runPnpmInstall();\n  }\n\n  /**\n   * æ£€æŸ¥ä¾èµ–æ˜¯å¦éœ€è¦æ›´æ–°\n   * @returns {Promise<boolean>} trueè¡¨ç¤ºéœ€è¦æ›´æ–°\n   */\n  async checkDependenciesNeedUpdate() {\n    const packageJsonPath = this.directoryManager.getPackageJsonPath();\n    \n    try {\n      // è¯»å–ç°æœ‰çš„package.json\n      const existingContent = await fs.readFile(packageJsonPath, 'utf-8');\n      const existingPackageJson = JSON.parse(existingContent);\n      const existingDeps = existingPackageJson.dependencies || {};\n      \n      // æ„å»ºæ–°çš„ä¾èµ–å¯¹è±¡\n      let newDeps = {};\n      if (typeof this.dependencies === 'object' && !Array.isArray(this.dependencies)) {\n        // æ–°æ ¼å¼ï¼šç›´æ¥ä½¿ç”¨å¯¹è±¡\n        newDeps = this.dependencies;\n      } else if (Array.isArray(this.dependencies)) {\n        // å…¼å®¹æ—§æ ¼å¼ï¼ˆæ•°ç»„ï¼‰\n        for (const dep of this.dependencies) {\n          if (dep.includes('@')) {\n            const lastAtIndex = dep.lastIndexOf('@');\n            if (lastAtIndex > 0) {\n              const name = dep.substring(0, lastAtIndex);\n              const version = dep.substring(lastAtIndex + 1);\n              newDeps[name] = version;\n            } else {\n              newDeps[dep] = 'latest';\n            }\n          } else {\n            newDeps[dep] = 'latest';\n          }\n        }\n      }\n      \n      // æ¯”è¾ƒä¾èµ–æ˜¯å¦ä¸€è‡´\n      const existingKeys = Object.keys(existingDeps).sort();\n      const newKeys = Object.keys(newDeps).sort();\n      \n      // æ£€æŸ¥é”®æ˜¯å¦ç›¸åŒ\n      if (existingKeys.length !== newKeys.length || \n          !existingKeys.every((key, index) => key === newKeys[index])) {\n        logger.debug(`[ToolSandbox] Dependency list changed - old: ${existingKeys.join(', ')} | new: ${newKeys.join(', ')}`);\n        return true;\n      }\n      \n      // æ£€æŸ¥ç‰ˆæœ¬æ˜¯å¦ç›¸åŒ\n      for (const key of existingKeys) {\n        if (existingDeps[key] !== newDeps[key]) {\n          logger.debug(`[ToolSandbox] Dependency version changed - ${key}: ${existingDeps[key]} -> ${newDeps[key]}`);\n          return true;\n        }\n      }\n      \n      return false;\n    } catch (error) {\n      // æ–‡ä»¶ä¸å­˜åœ¨æˆ–è§£æå¤±è´¥ï¼Œéœ€è¦åˆ›å»º\n      logger.debug(`[ToolSandbox] package.json does not exist or is invalid, needs to be created`);\n      return true;\n    }\n  }\n\n  /**\n   * åˆ›å»ºpackage.json\n   */\n  async createPackageJson() {\n    const packageJsonPath = this.directoryManager.getPackageJsonPath();\n    \n    const packageJson = {\n      name: `toolbox-${this.toolId}`,\n      version: '1.0.0',\n      description: `Sandbox for tool: ${this.toolId}`,\n      private: true,\n      dependencies: {}\n    };\n    \n    // ç›´æ¥ä½¿ç”¨ getDependencies è¿”å›çš„å¯¹è±¡æ ¼å¼ {\"package-name\": \"version\"}\n    logger.debug(`[ToolSandbox] Processing dependencies: ${JSON.stringify(this.dependencies)}`);\n    if (typeof this.dependencies === 'object' && !Array.isArray(this.dependencies)) {\n      // æ–°æ ¼å¼ï¼šç›´æ¥ä½¿ç”¨å¯¹è±¡\n      packageJson.dependencies = this.dependencies;\n    } else if (Array.isArray(this.dependencies)) {\n      // å…¼å®¹æ—§æ ¼å¼ï¼ˆæ•°ç»„ï¼‰ï¼Œä½†åº”è¯¥é€æ­¥åºŸå¼ƒ\n      logger.warn(`[ToolSandbox] Tool ${this.toolId} is using deprecated array format for dependencies. Please update to object format.`);\n      for (const dep of this.dependencies) {\n        if (dep.includes('@')) {\n          const lastAtIndex = dep.lastIndexOf('@');\n          if (lastAtIndex > 0) {\n            const name = dep.substring(0, lastAtIndex);\n            const version = dep.substring(lastAtIndex + 1);\n            logger.debug(`[ToolSandbox] Parsing dependency \"${dep}\" => name=\"${name}\", version=\"${version}\"`);\n            packageJson.dependencies[name] = version;\n          } else {\n            // åªæœ‰ @ å¼€å¤´ï¼Œæ²¡æœ‰ç‰ˆæœ¬å·çš„æƒ…å†µï¼ˆå¦‚ @scope/packageï¼‰\n            packageJson.dependencies[dep] = 'latest';\n          }\n        } else {\n          packageJson.dependencies[dep] = 'latest';\n        }\n      }\n    }\n    \n    await fs.writeFile(packageJsonPath, JSON.stringify(packageJson, null, 2));\n  }\n\n  /**\n   * è¿è¡Œpnpmå®‰è£…\n   */\n  async runPnpmInstall() {\n    const startTime = Date.now();\n    \n    // æ„å»ºä¾èµ–åˆ—è¡¨ä¿¡æ¯ç”¨äºæ—¥å¿—\n    let depsList = '';\n    if (typeof this.dependencies === 'object' && !Array.isArray(this.dependencies)) {\n      depsList = Object.keys(this.dependencies).map(name => `${name}@${this.dependencies[name]}`).join(', ');\n    } else if (Array.isArray(this.dependencies)) {\n      depsList = this.dependencies.join(', ');\n    }\n    \n    logger.info(`[ToolSandbox] Installing dependencies: [${depsList}]`);\n    \n    return new Promise((resolve, reject) => {\n      // è·å–å†…ç½®pnpmè·¯å¾„ - ç›´æ¥ä»node_modulesè·å–\n      const pnpmModulePath = require.resolve('pnpm');\n      const pnpmBinPath = path.join(path.dirname(pnpmModulePath), 'bin', 'pnpm.cjs');\n      \n      const nodeExecutable = process.env.PROMPTX_NODE_EXECUTABLE || 'node';\n      \n      // å‡†å¤‡å­è¿›ç¨‹ç¯å¢ƒå˜é‡\n      const spawnEnv = { ...process.env };\n      \n      // å¦‚æœä½¿ç”¨ Electron ä½œä¸º Node.jsï¼Œéœ€è¦è®¾ç½® ELECTRON_RUN_AS_NODE\n      // ä½†åªåœ¨è¿™ä¸ªå­è¿›ç¨‹ä¸­è®¾ç½®ï¼Œä¸æ±¡æŸ“ä¸»è¿›ç¨‹\n      if (nodeExecutable === process.env.PROMPTX_NODE_EXECUTABLE && nodeExecutable.includes('electron')) {\n        spawnEnv.ELECTRON_RUN_AS_NODE = '1';\n        logger.info(`[ToolSandbox] Setting ELECTRON_RUN_AS_NODE=1 for this subprocess only`);\n      }\n      \n      // Add CI=1 to environment to enable non-interactive mode\n      spawnEnv.CI = '1';\n      \n      // æ„å»ºpnpmå‚æ•°æ•°ç»„\n      const pnpmArgs = [\n        pnpmBinPath, \n        'install',\n        '--config.confirmModulesPurge=false',\n        '--prefer-offline',\n        '--ignore-scripts',\n        '--reporter=append-only'\n      ];\n      \n      const fullCommand = `${nodeExecutable} ${pnpmArgs.join(' ')}`;\n      \n      logger.info(`[ToolSandbox] Executing command: ${fullCommand}`);\n      logger.info(`[ToolSandbox] Working directory: ${this.directoryManager.getToolboxPath()}`);\n      logger.info(`[ToolSandbox] Using Node.js executable: ${nodeExecutable}`);\n      \n      // 30ç§’è¶…æ—¶\n      const timeout = setTimeout(() => {\n        const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);\n        logger.error(`[ToolSandbox] pnpm install timeout (${elapsed}s > 30s)`);\n        logger.error(`[ToolSandbox] Command: ${fullCommand}`);\n        logger.error(`[ToolSandbox] Working directory: ${this.directoryManager.getToolboxPath()}`);\n        logger.error(`[ToolSandbox] Installing packages: [${depsList}]`);\n        logger.error(`[ToolSandbox] Stdout output: ${stdout}`);\n        logger.error(`[ToolSandbox] Stderr output: ${stderr}`);\n        pnpm.kill('SIGTERM');\n        reject(new Error(`pnpm install timeout after 30s. Command: ${fullCommand}`));\n      }, 30000);\n      \n      const pnpm = spawn(nodeExecutable, pnpmArgs, {\n        cwd: this.directoryManager.getToolboxPath(),  // ä½¿ç”¨ toolbox è·¯å¾„å®‰è£…ä¾èµ–\n        env: spawnEnv,  // ä½¿ç”¨å®šåˆ¶çš„ç¯å¢ƒå˜é‡\n        stdio: 'pipe'\n      });\n      \n      let stdout = '';\n      let stderr = '';\n      \n      pnpm.stdout.on('data', (data) => {\n        const output = data.toString();\n        stdout += output;\n        logger.debug(`[ToolSandbox] pnpm stdout: ${output}`);\n      });\n      \n      pnpm.stderr.on('data', (data) => {\n        const error = data.toString();\n        stderr += error;\n        logger.warn(`[ToolSandbox] pnpm stderr: ${error}`);\n      });\n      \n      pnpm.on('close', (code) => {\n        clearTimeout(timeout);\n        const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);\n        \n        if (code === 0) {\n          logger.info(`[ToolSandbox] Dependencies installed successfully in ${elapsed}s`);\n          logger.debug(`[ToolSandbox] Installed packages: [${depsList}]`);\n          resolve({ stdout, stderr });\n        } else {\n          logger.error(`[ToolSandbox] pnpm install failed with exit code ${code} after ${elapsed}s`);\n          logger.error(`[ToolSandbox] Command: ${fullCommand}`);\n          logger.error(`[ToolSandbox] Working directory: ${this.directoryManager.getToolboxPath()}`);\n          logger.error(`[ToolSandbox] Installing packages: [${depsList}]`);\n          logger.error(`[ToolSandbox] Stdout: ${stdout}`);\n          logger.error(`[ToolSandbox] Stderr: ${stderr}`);\n          reject(new Error(`pnpm install failed with code ${code}: ${stderr}`));\n        }\n      });\n      \n      pnpm.on('error', (error) => {\n        logger.error(`[ToolSandbox] Failed to spawn pnpm: ${error.message}`);\n        reject(new Error(`Failed to spawn pnpm: ${error.message}`));\n      });\n    });\n  }\n\n  /**\n   * æ£€æµ‹å’Œå¤„ç† ES Module ä¾èµ–\n   */\n  async detectAndHandleESModules() {\n    // åˆå§‹åŒ– ES Module æ”¯æŒå™¨\n    if (!this.esModuleSupport) {\n      this.esModuleSupport = new ESModuleRequireSupport(this.directoryManager.getToolboxPath());\n    }\n\n    // æ£€æµ‹ä¾èµ–ç±»å‹\n    const dependencyTypes = await this.esModuleSupport.detectDependenciesTypes(this.dependencies);\n    \n    if (dependencyTypes.esmodule.length > 0) {\n      logger.warn(`[ToolSandbox] æ£€æµ‹åˆ° ES Module ä¾èµ–ï¼š`, dependencyTypes.esmodule.map(d => d.name).join(', '));\n      logger.info(`[ToolSandbox] ES Module åŒ…éœ€è¦ä½¿ç”¨åŠ¨æ€ import() åŠ è½½ï¼Œå·¥å…·å¯èƒ½éœ€è¦ç›¸åº”è°ƒæ•´`);\n      \n      // å­˜å‚¨ ES Module ä¿¡æ¯ä¾›åç»­ä½¿ç”¨\n      this.esModuleDependencies = dependencyTypes.esmodule;\n    }\n\n    if (dependencyTypes.unknown.length > 0) {\n      logger.debug(`[ToolSandbox] æ— æ³•æ£€æµ‹çš„ä¾èµ–ç±»å‹ï¼š`, dependencyTypes.unknown.map(d => d.name).join(', '));\n    }\n\n    return dependencyTypes;\n  }\n\n  /**\n   * åˆ›å»ºæ‰§è¡Œæ²™ç®±ç¯å¢ƒ\n   */\n  async createExecutionSandbox() {\n    // åˆ›å»ºæ‰§è¡Œé˜¶æ®µçš„éš”ç¦»ç®¡ç†å™¨ï¼Œä½¿ç”¨å·¥ä½œç›®å½•\n    this.isolationManager = new SandboxIsolationManager(this.directoryManager.getWorkingPath(), {\n      enableDependencyLoading: true,\n      analysisMode: false,\n      toolboxPath: this.directoryManager.getToolboxPath()  // ä¼ é€’ toolbox è·¯å¾„ç”¨äºä¾èµ–åŠ è½½\n    });\n    \n    this.sandboxContext = this.isolationManager.createIsolatedContext();\n    \n    // æ·»åŠ  ES Module åŠ¨æ€åŠ è½½æ”¯æŒ\n    // å§‹ç»ˆæä¾› importModule å‡½æ•°ï¼Œä»¥æ”¯æŒå·¥å…·åŠ¨æ€åŠ è½½ ES Module\n    if (!this.esModuleSupport) {\n      this.esModuleSupport = new ESModuleRequireSupport(this.directoryManager.getToolboxPath());\n    }\n    \n    // ç»Ÿä¸€çš„æ¨¡å—åŠ è½½å‡½æ•° - è‡ªåŠ¨æ£€æµ‹å¹¶åŠ è½½\n    this.sandboxContext.loadModule = async (moduleName) => {\n      const moduleType = await this.esModuleSupport.detectModuleType(moduleName);\n      if (moduleType === 'esm') {\n        // ES Module - å°è¯•åŠ¨æ€ import\n        try {\n          return await this.esModuleSupport.loadESModule(moduleName);\n        } catch (error) {\n          // å¦‚æœåŠ¨æ€ import å¤±è´¥ï¼Œå°è¯•é€šè¿‡ require åŠ è½½å¹¶æå– default\n          const module = this.sandboxContext.require(moduleName);\n          // Node.js çš„ createRequire ä¼šå°† ES Module åŒ…è£…ï¼ŒçœŸæ­£çš„å¯¼å‡ºåœ¨ default ä¸­\n          return module.default || module;\n        }\n      } else {\n        return this.sandboxContext.require(moduleName);\n      }\n    };\n    \n    // ä¿ç•™ importModule ä½œä¸ºåˆ«åï¼ˆå‘åå…¼å®¹ï¼‰\n    this.sandboxContext.importModule = this.sandboxContext.loadModule;\n    \n    // å¢å¼º require - ä¸»åŠ¨æ£€æµ‹ ES Module å¹¶é˜»æ­¢åŠ è½½\n    const originalRequire = this.sandboxContext.require;\n    const esModuleSupport = this.esModuleSupport;  // æ•è·å¼•ç”¨ç”¨äºé—­åŒ…\n    \n    this.sandboxContext.require = function(moduleName) {\n      // ä¸»åŠ¨æ£€æµ‹æ˜¯å¦æ˜¯ ES Moduleï¼ˆä½¿ç”¨åŒæ­¥æ–¹æ³•é¿å… asyncï¼‰\n      try {\n        const packageJsonPath = require.resolve(`${moduleName}/package.json`, {\n          paths: [esModuleSupport.toolboxPath]\n        });\n        const packageJson = require(packageJsonPath);\n        \n        if (packageJson.type === 'module') {\n          // æ˜¯ ES Moduleï¼Œä¸»åŠ¨æŠ›å‡ºé”™è¯¯\n          const error = new Error(\n            `âŒ \"${moduleName}\" æ˜¯ ES Module åŒ…ï¼Œè¯·ä½¿ç”¨ await loadModule('${moduleName}') ä»£æ›¿ require('${moduleName}')\\n` +\n            `ğŸ’¡ æç¤ºï¼šloadModule ä¼šè‡ªåŠ¨æ£€æµ‹åŒ…ç±»å‹å¹¶æ­£ç¡®åŠ è½½`\n          );\n          error.code = 'ERR_REQUIRE_ESM';\n          throw error;\n        }\n      } catch (checkError) {\n        // å¦‚æœæ£€æµ‹å¤±è´¥ï¼ˆæ¯”å¦‚åŒ…ä¸å­˜åœ¨ï¼‰ï¼Œè®©åŸå§‹ require å¤„ç†\n        if (checkError.code === 'ERR_REQUIRE_ESM') {\n          throw checkError;  // é‡æ–°æŠ›å‡ºæˆ‘ä»¬çš„é”™è¯¯\n        }\n      }\n      \n      // ä¸æ˜¯ ES Module æˆ–æ£€æµ‹å¤±è´¥ï¼Œä½¿ç”¨åŸå§‹ require\n      const result = originalRequire(moduleName);\n      \n      // é¢å¤–æ£€æŸ¥ï¼šå¦‚æœè¿”å›å¯¹è±¡æœ‰ __esModule å’Œ defaultï¼Œè¯´æ˜æ˜¯è¢«åŒ…è£…çš„ ES Module\n      if (result && result.__esModule && result.default && !result.default.__esModule) {\n        // è¿™æ˜¯ createRequire åŒ…è£…çš„ ES Moduleï¼Œåº”è¯¥æŠ¥é”™\n        const error = new Error(\n          `âŒ \"${moduleName}\" æ˜¯ ES Module åŒ…ï¼Œè¯·ä½¿ç”¨ await loadModule('${moduleName}') ä»£æ›¿ require('${moduleName}')\\n` +\n          `ğŸ’¡ æç¤ºï¼šloadModule ä¼šè‡ªåŠ¨æ£€æµ‹åŒ…ç±»å‹å¹¶æ­£ç¡®åŠ è½½`\n        );\n        error.code = 'ERR_REQUIRE_ESM';\n        throw error;\n      }\n      \n      return result;\n    };\n    \n    if (this.esModuleDependencies && this.esModuleDependencies.length > 0) {\n      logger.debug(`[ToolSandbox] å·²ä¸ºå·¥å…· ${this.toolId} å¯ç”¨ ES Module æ”¯æŒï¼Œæ£€æµ‹åˆ° ${this.esModuleDependencies.length} ä¸ª ES Module ä¾èµ–`);\n    } else {\n      logger.debug(`[ToolSandbox] å·²ä¸ºå·¥å…· ${this.toolId} å¯ç”¨ importModule å‡½æ•°`);\n    }\n    \n    // åœ¨å®Œå…¨éš”ç¦»çš„æ²™ç®±ä¸­é‡æ–°åŠ è½½å·¥å…·\n    const script = new vm.Script(this.toolContent, { filename: `${this.toolId}.js` });\n    const context = vm.createContext(this.sandboxContext);\n    \n    script.runInContext(context);\n    const exported = context.module.exports;\n    \n    if (typeof exported === 'function') {\n      this.toolInstance = new exported();\n    } else if (typeof exported === 'object') {\n      this.toolInstance = exported;\n    }\n  }\n\n\n  /**\n   * è§£æåè®®è·¯å¾„ï¼ˆæ”¯æŒ@project://ç­‰åè®®ï¼‰\n   * @param {string} protocolPath - åè®®è·¯å¾„ï¼Œå¦‚@project://.promptx/cwd\n   * @returns {Promise<string>} è§£æåçš„ç»å¯¹è·¯å¾„\n   */\n  async resolveProtocolPath(protocolPath) {\n    // å¤„ç†undefinedæˆ–nullçš„æƒ…å†µ\n    if (!protocolPath) {\n      throw new Error('protocolPath is required but was undefined');\n    }\n    \n    // ğŸš€ æ–°æ¶æ„ï¼š@projectåè®®ç›´æ¥ä½¿ç”¨ProjectPathResolver\n    if (protocolPath.startsWith('@project://')) {\n      const { getGlobalProjectPathResolver } = require('../utils/ProjectPathResolver');\n      const pathResolver = getGlobalProjectPathResolver();\n      \n      try {\n        // æå–åè®®è·¯å¾„çš„ç›¸å¯¹éƒ¨åˆ†\n        const relativePath = protocolPath.replace(/^@project:\\/\\//, '');\n        const resolvedPath = pathResolver.resolvePath(relativePath);\n        \n        // ç¡®ä¿ç›®å½•å­˜åœ¨\n        const fs = require('fs').promises;\n        try {\n          await fs.access(resolvedPath);\n        } catch (error) {\n          if (error.code === 'ENOENT') {\n            await fs.mkdir(resolvedPath, { recursive: true });\n            logger.debug(`[ToolSandbox] Created unified working directory: ${resolvedPath}`);\n          }\n        }\n        \n        return resolvedPath;\n      } catch (error) {\n        throw new Error(`è§£æ@project://è·¯å¾„å¤±è´¥: ${error.message}`);\n      }\n    }\n    \n    // å…¶ä»–åè®®è·¯å¾„ä½¿ç”¨ResourceManagerè§£æ\n    if (protocolPath.startsWith('@')) {\n      if (!this.resourceManager) {\n        throw new Error('ResourceManager not set. Cannot resolve protocol path.');\n      }\n      \n      // å…¶ä»–åè®®å¤„ç†é€»è¾‘ä¿æŒä¸å˜\n      throw new Error(`æš‚ä¸æ”¯æŒçš„åè®®è·¯å¾„: ${protocolPath}`);\n    }\n    \n    // æ™®é€šè·¯å¾„ç›´æ¥è¿”å›\n    return protocolPath;\n  }\n\n\n\n\n  /**\n   * å‚æ•°éªŒè¯\n   */\n  async validateParameters(parameters) {\n    if (typeof this.toolInstance.validate === 'function') {\n      const result = this.toolInstance.validate(parameters);\n      \n      if (typeof result === 'boolean' && !result) {\n        throw new Error('Parameter validation failed');\n      } else if (result && typeof result === 'object' && !result.valid) {\n        throw new Error(`Parameter validation failed: ${result.errors?.join(', ')}`);\n      }\n    }\n  }\n\n  /**\n   * åœ¨æ²™ç®±ä¸­æ‰§è¡Œå·¥å…·\n   */\n  async executeInSandbox(parameters) {\n    if (!this.toolInstance || typeof this.toolInstance.execute !== 'function') {\n      throw new Error(`Tool ${this.toolId} does not have execute method`);\n    }\n    \n    return await this.toolInstance.execute(parameters);\n  }\n\n  /**\n   * è·å–åˆ†æç»“æœ\n   */\n  getAnalysisResult() {\n    return {\n      toolId: this.toolId,\n      dependencies: this.dependencies,\n      sandboxPath: this.directoryManager?.getWorkingPath(),\n      toolboxPath: this.directoryManager?.getToolboxPath(),\n      hasMetadata: typeof this.toolInstance?.getMetadata === 'function',\n      hasSchema: typeof this.toolInstance?.getSchema === 'function'\n    };\n  }\n\n  /**\n   * æ¸…ç†æ²™ç®±èµ„æº\n   */\n  async cleanup() {\n    // æ¸…ç†éš”ç¦»ç®¡ç†å™¨\n    if (this.isolationManager) {\n      this.isolationManager.cleanup();\n      this.isolationManager = null;\n    }\n    \n    // æ¸…ç† ES Module æ”¯æŒå™¨\n    if (this.esModuleSupport) {\n      this.esModuleSupport.clearCache();\n      this.esModuleSupport = null;\n    }\n    \n    // æ¸…ç†å…¶ä»–èµ„æº\n    this.sandboxContext = null;\n    this.toolInstance = null;\n    this.esModuleDependencies = null;\n  }\n\n  /**\n   * è·å–å·¥å…·å…ƒä¿¡æ¯\n   */\n  getToolMetadata() {\n    if (this.toolInstance && typeof this.toolInstance.getMetadata === 'function') {\n      return this.toolInstance.getMetadata();\n    }\n    return null;\n  }\n\n  /**\n   * è·å–å·¥å…·Schema\n   */\n  getToolSchema() {\n    if (this.toolInstance && typeof this.toolInstance.getSchema === 'function') {\n      return this.toolInstance.getSchema();\n    }\n    return null;\n  }\n}\n\nmodule.exports = ToolSandbox;","/**\n * ToolInterface - PromptXå·¥å…·æ¥å£è§„èŒƒ\n * å®šä¹‰é¸­å­ç±»å‹çš„å·¥å…·æ¥å£ï¼Œå¤–éƒ¨å·¥å…·æ— éœ€ç»§æ‰¿ä»»ä½•ç±»\n */\n\n/**\n * Toolæ¥å£è§„èŒƒå®šä¹‰\n */\nconst TOOL_INTERFACE = {\n  // å¿…é¡»å®ç°çš„æ–¹æ³•\n  required: [\n    {\n      name: 'getMetadata',\n      signature: '() => Object',\n      description: 'è·å–å·¥å…·å…ƒä¿¡æ¯',\n      returns: {\n        name: 'string - å·¥å…·åç§°',\n        description: 'string - å·¥å…·æè¿°', \n        version: 'string - ç‰ˆæœ¬å·',\n        category: 'string - åˆ†ç±»ï¼ˆå¯é€‰ï¼‰',\n        author: 'string - ä½œè€…ï¼ˆå¯é€‰ï¼‰'\n      }\n    },\n    {\n      name: 'getSchema',\n      signature: '() => Object',\n      description: 'è·å–å‚æ•°JSON Schema',\n      returns: {\n        type: 'string - å‚æ•°ç±»å‹ï¼Œé€šå¸¸ä¸ºobject',\n        properties: 'Object - å‚æ•°å±æ€§å®šä¹‰',\n        required: 'Array - å¿…éœ€å‚æ•°åˆ—è¡¨ï¼ˆå¯é€‰ï¼‰',\n        additionalProperties: 'boolean - æ˜¯å¦å…è®¸é¢å¤–å‚æ•°ï¼ˆå¯é€‰ï¼‰'\n      }\n    },\n    {\n      name: 'execute',\n      signature: '(parameters: Object) => Promise<any>',\n      description: 'æ‰§è¡Œå·¥å…·ä¸»é€»è¾‘',\n      parameters: {\n        parameters: 'Object - å·¥å…·å‚æ•°ï¼Œç¬¦åˆgetSchemaå®šä¹‰'\n      },\n      returns: 'Promise<any> - å·¥å…·æ‰§è¡Œç»“æœ'\n    }\n  ],\n\n  // å¯é€‰å®ç°çš„æ–¹æ³•\n  optional: [\n    {\n      name: 'getPackage',\n      signature: '() => Object',\n      description: 'è·å–å·¥å…·åŒ…ä¿¡æ¯ï¼ˆå¯é€‰ï¼Œç”¨äºä¾èµ–ç®¡ç†ï¼‰',\n      returns: {\n        directory: 'string - å·¥å…·ç›®å½•è·¯å¾„',\n        dependencies: 'Object - ä¾èµ–å¯¹è±¡ï¼Œæ ¼å¼ï¼š{åŒ…å: ç‰ˆæœ¬}',\n        packageJson: 'Object - package.jsonå†…å®¹ï¼ˆå¯é€‰ï¼‰'\n      }\n    },\n    {\n      name: 'validate',\n      signature: '(parameters: Object) => Object',\n      description: 'éªŒè¯å‚æ•°ï¼ˆå¯é€‰ï¼Œæœ‰é»˜è®¤å®ç°ï¼‰',\n      parameters: {\n        parameters: 'Object - å¾…éªŒè¯å‚æ•°'\n      },\n      returns: {\n        valid: 'boolean - éªŒè¯æ˜¯å¦é€šè¿‡',\n        errors: 'Array<string> - é”™è¯¯ä¿¡æ¯åˆ—è¡¨'\n      }\n    },\n    {\n      name: 'cleanup',\n      signature: '() => void | Promise<void>',\n      description: 'æ¸…ç†èµ„æºï¼ˆå¯é€‰ï¼‰',\n      returns: 'void | Promise<void>'\n    },\n    {\n      name: 'init',\n      signature: '(config?: Object) => void | Promise<void>',\n      description: 'åˆå§‹åŒ–å·¥å…·ï¼ˆå¯é€‰ï¼‰',\n      parameters: {\n        config: 'Object - åˆå§‹åŒ–é…ç½®ï¼ˆå¯é€‰ï¼‰'\n      },\n      returns: 'void | Promise<void>'\n    }\n  ]\n};\n\n/**\n * å·¥å…·é”™è¯¯ç±»å‹å®šä¹‰\n */\nconst TOOL_ERROR_CODES = {\n  VALIDATION_ERROR: 'VALIDATION_ERROR',     // å‚æ•°éªŒè¯å¤±è´¥\n  EXECUTION_ERROR: 'EXECUTION_ERROR',       // æ‰§è¡Œé”™è¯¯\n  TIMEOUT_ERROR: 'TIMEOUT_ERROR',           // è¶…æ—¶é”™è¯¯\n  PERMISSION_ERROR: 'PERMISSION_ERROR',     // æƒé™é”™è¯¯\n  RESOURCE_ERROR: 'RESOURCE_ERROR',         // èµ„æºé”™è¯¯\n  CONFIGURATION_ERROR: 'CONFIGURATION_ERROR' // é…ç½®é”™è¯¯\n};\n\n/**\n * æ ‡å‡†ç»“æœæ ¼å¼å®šä¹‰\n */\nconst TOOL_RESULT_FORMAT = {\n  success: {\n    success: true,\n    data: 'any - å·¥å…·è¿”å›çš„å®é™…æ•°æ®',\n    metadata: {\n      tool: 'string - å·¥å…·åç§°',\n      executionTime: 'string - æ‰§è¡Œæ—¶é—´',\n      timestamp: 'string - æ—¶é—´æˆ³',\n      // ...å…¶ä»–å…ƒä¿¡æ¯\n    }\n  },\n  \n  error: {\n    success: false,\n    error: {\n      code: 'string - é”™è¯¯ä»£ç ï¼ˆè§TOOL_ERROR_CODESï¼‰',\n      message: 'string - é”™è¯¯æ¶ˆæ¯',\n      details: 'Object - é”™è¯¯è¯¦æƒ…ï¼ˆå¯é€‰ï¼‰'\n    },\n    metadata: {\n      tool: 'string - å·¥å…·åç§°',\n      timestamp: 'string - æ—¶é—´æˆ³',\n      // ...å…¶ä»–å…ƒä¿¡æ¯\n    }\n  }\n};\n\n/**\n * ç¤ºä¾‹å·¥å…·å®ç°\n */\nconst EXAMPLE_TOOL = `\nclass ExampleTool {\n  getMetadata() {\n    return {\n      name: 'example-tool',\n      description: 'ç¤ºä¾‹å·¥å…·',\n      version: '1.0.0',\n      category: 'example',\n      author: 'PromptX Team'\n    };\n  }\n\n  getSchema() {\n    return {\n      type: 'object',\n      properties: {\n        input: {\n          type: 'string',\n          description: 'è¾“å…¥å‚æ•°'\n        }\n      },\n      required: ['input'],\n      additionalProperties: false\n    };\n  }\n\n  async execute(parameters) {\n    const { input } = parameters;\n    \n    // å·¥å…·é€»è¾‘\n    const result = \\`å¤„ç†ç»“æœ: \\${input}\\`;\n    \n    return result;\n  }\n\n  // å¯é€‰ï¼šå£°æ˜ä¾èµ–ï¼ˆæ–°æ ¼å¼ï¼šå¯¹è±¡ï¼‰\n  getDependencies() {\n    return {\n      'lodash': '^4.17.21',\n      'axios': '^1.6.0'\n    };\n  }\n\n  // å¯é€‰ï¼šè‡ªå®šä¹‰å‚æ•°éªŒè¯\n  validate(parameters) {\n    const errors = [];\n    \n    if (!parameters.input || parameters.input.trim() === '') {\n      errors.push('inputä¸èƒ½ä¸ºç©º');\n    }\n    \n    return { valid: errors.length === 0, errors };\n  }\n\n  // å¯é€‰ï¼šæ¸…ç†èµ„æº\n  cleanup() {\n    console.log('æ¸…ç†èµ„æº');\n  }\n}\n\nmodule.exports = ExampleTool;\n`;\n\nmodule.exports = {\n  TOOL_INTERFACE,\n  TOOL_ERROR_CODES,\n  TOOL_RESULT_FORMAT,\n  EXAMPLE_TOOL\n};","const { TOOL_INTERFACE, TOOL_ERROR_CODES } = require('./ToolInterface');\n\n/**\n * ToolValidator - å·¥å…·æ¥å£éªŒè¯å™¨\n * ä½¿ç”¨é¸­å­ç±»å‹éªŒè¯å·¥å…·æ˜¯å¦ç¬¦åˆPromptXæ¥å£è§„èŒƒ\n */\nclass ToolValidator {\n  /**\n   * éªŒè¯å·¥å…·æ˜¯å¦ç¬¦åˆæ¥å£è§„èŒƒ\n   * @param {any} tool - å¾…éªŒè¯çš„å·¥å…·å¯¹è±¡\n   * @returns {Object} éªŒè¯ç»“æœ {valid: boolean, errors: [], warnings: []}\n   */\n  static validateTool(tool) {\n    const errors = [];\n    const warnings = [];\n\n    // åŸºç¡€ç±»å‹æ£€æŸ¥\n    if (!tool || typeof tool !== 'object') {\n      errors.push('å·¥å…·å¿…é¡»æ˜¯å¯¹è±¡ç±»å‹');\n      return { valid: false, errors, warnings };\n    }\n\n    // éªŒè¯å¿…éœ€æ–¹æ³•\n    for (const methodSpec of TOOL_INTERFACE.required) {\n      const methodName = methodSpec.name;\n      \n      if (!(methodName in tool)) {\n        errors.push(`ç¼ºå°‘å¿…éœ€æ–¹æ³•: ${methodName}`);\n        continue;\n      }\n      \n      if (typeof tool[methodName] !== 'function') {\n        errors.push(`${methodName} å¿…é¡»æ˜¯å‡½æ•°ç±»å‹`);\n        continue;\n      }\n\n      // æ–¹æ³•ç­¾åéªŒè¯\n      try {\n        const validationResult = this.validateMethod(tool, methodSpec);\n        if (!validationResult.valid) {\n          errors.push(...validationResult.errors);\n          warnings.push(...validationResult.warnings);\n        }\n      } catch (error) {\n        warnings.push(`${methodName} æ–¹æ³•éªŒè¯æ—¶å‡ºé”™: ${error.message}`);\n      }\n    }\n\n    // éªŒè¯å¯é€‰æ–¹æ³•\n    for (const methodSpec of TOOL_INTERFACE.optional) {\n      const methodName = methodSpec.name;\n      \n      if (methodName in tool) {\n        if (typeof tool[methodName] !== 'function') {\n          warnings.push(`${methodName} åº”è¯¥æ˜¯å‡½æ•°ç±»å‹`);\n        } else {\n          try {\n            const validationResult = this.validateMethod(tool, methodSpec);\n            if (!validationResult.valid) {\n              warnings.push(...validationResult.errors);\n            }\n          } catch (error) {\n            warnings.push(`${methodName} æ–¹æ³•éªŒè¯æ—¶å‡ºé”™: ${error.message}`);\n          }\n        }\n      }\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors,\n      warnings\n    };\n  }\n\n  /**\n   * éªŒè¯ç‰¹å®šæ–¹æ³•\n   * @param {Object} tool - å·¥å…·å¯¹è±¡\n   * @param {Object} methodSpec - æ–¹æ³•è§„èŒƒ\n   * @returns {Object} éªŒè¯ç»“æœ\n   */\n  static validateMethod(tool, methodSpec) {\n    const errors = [];\n    const warnings = [];\n    const methodName = methodSpec.name;\n\n    try {\n      switch (methodName) {\n        case 'getMetadata':\n          return this.validateGetMetadata(tool);\n        case 'getSchema':\n          return this.validateGetSchema(tool);\n        case 'execute':\n          return this.validateExecute(tool);\n        case 'validate':\n          return this.validateValidateMethod(tool);\n        default:\n          return { valid: true, errors: [], warnings: [] };\n      }\n    } catch (error) {\n      errors.push(`${methodName} æ–¹æ³•è°ƒç”¨å¤±è´¥: ${error.message}`);\n      return { valid: false, errors, warnings };\n    }\n  }\n\n  /**\n   * éªŒè¯getMetadataæ–¹æ³•\n   * @param {Object} tool - å·¥å…·å¯¹è±¡\n   * @returns {Object} éªŒè¯ç»“æœ\n   */\n  static validateGetMetadata(tool) {\n    const errors = [];\n    const warnings = [];\n\n    try {\n      const metadata = tool.getMetadata();\n      \n      if (!metadata || typeof metadata !== 'object') {\n        errors.push('getMetadata() å¿…é¡»è¿”å›å¯¹è±¡');\n        return { valid: false, errors, warnings };\n      }\n\n      // éªŒè¯å¿…éœ€å­—æ®µ\n      if (!metadata.name || typeof metadata.name !== 'string') {\n        errors.push('metadata.name å¿…é¡»æ˜¯éç©ºå­—ç¬¦ä¸²');\n      }\n\n      if (!metadata.description || typeof metadata.description !== 'string') {\n        errors.push('metadata.description å¿…é¡»æ˜¯éç©ºå­—ç¬¦ä¸²');\n      }\n\n      if (!metadata.version || typeof metadata.version !== 'string') {\n        errors.push('metadata.version å¿…é¡»æ˜¯éç©ºå­—ç¬¦ä¸²');\n      }\n\n      // éªŒè¯å¯é€‰å­—æ®µ\n      if (metadata.category && typeof metadata.category !== 'string') {\n        warnings.push('metadata.category åº”è¯¥æ˜¯å­—ç¬¦ä¸²ç±»å‹');\n      }\n\n      if (metadata.author && typeof metadata.author !== 'string') {\n        warnings.push('metadata.author åº”è¯¥æ˜¯å­—ç¬¦ä¸²ç±»å‹');\n      }\n\n    } catch (error) {\n      errors.push(`getMetadata() æ‰§è¡Œå¤±è´¥: ${error.message}`);\n    }\n\n    return { valid: errors.length === 0, errors, warnings };\n  }\n\n  /**\n   * éªŒè¯getSchemaæ–¹æ³•\n   * @param {Object} tool - å·¥å…·å¯¹è±¡\n   * @returns {Object} éªŒè¯ç»“æœ\n   */\n  static validateGetSchema(tool) {\n    const errors = [];\n    const warnings = [];\n\n    try {\n      const schema = tool.getSchema();\n      \n      if (!schema || typeof schema !== 'object') {\n        errors.push('getSchema() å¿…é¡»è¿”å›å¯¹è±¡');\n        return { valid: false, errors, warnings };\n      }\n\n      // åŸºç¡€JSON SchemaéªŒè¯\n      if (!schema.type) {\n        warnings.push('schema.type å»ºè®®å®šä¹‰');\n      }\n\n      if (schema.type && typeof schema.type !== 'string') {\n        errors.push('schema.type å¿…é¡»æ˜¯å­—ç¬¦ä¸²');\n      }\n\n      if (schema.properties && typeof schema.properties !== 'object') {\n        errors.push('schema.properties å¿…é¡»æ˜¯å¯¹è±¡');\n      }\n\n      if (schema.required && !Array.isArray(schema.required)) {\n        errors.push('schema.required å¿…é¡»æ˜¯æ•°ç»„');\n      }\n\n    } catch (error) {\n      errors.push(`getSchema() æ‰§è¡Œå¤±è´¥: ${error.message}`);\n    }\n\n    return { valid: errors.length === 0, errors, warnings };\n  }\n\n  /**\n   * éªŒè¯executeæ–¹æ³•\n   * @param {Object} tool - å·¥å…·å¯¹è±¡\n   * @returns {Object} éªŒè¯ç»“æœ\n   */\n  static validateExecute(tool) {\n    const errors = [];\n    const warnings = [];\n\n    // æ£€æŸ¥æ–¹æ³•ç­¾å\n    const executeMethod = tool.execute;\n    if (executeMethod.length === 0) {\n      warnings.push('execute() æ–¹æ³•å»ºè®®æ¥å—parameterså‚æ•°');\n    }\n\n    // æ³¨æ„ï¼šè¿™é‡Œä¸å®é™…è°ƒç”¨executeæ–¹æ³•ï¼Œå› ä¸ºå¯èƒ½æœ‰å‰¯ä½œç”¨\n    // åªè¿›è¡Œé™æ€æ£€æŸ¥\n\n    return { valid: errors.length === 0, errors, warnings };\n  }\n\n  /**\n   * éªŒè¯validateæ–¹æ³•ï¼ˆå¯é€‰ï¼‰\n   * @param {Object} tool - å·¥å…·å¯¹è±¡\n   * @returns {Object} éªŒè¯ç»“æœ\n   */\n  static validateValidateMethod(tool) {\n    const errors = [];\n    const warnings = [];\n\n    try {\n      // æµ‹è¯•validateæ–¹æ³•çš„è¿”å›æ ¼å¼\n      const testParams = {};\n      const result = tool.validate(testParams);\n      \n      if (!result || typeof result !== 'object') {\n        errors.push('validate() å¿…é¡»è¿”å›å¯¹è±¡');\n        return { valid: false, errors, warnings };\n      }\n\n      if (typeof result.valid !== 'boolean') {\n        errors.push('validate() è¿”å›å€¼å¿…é¡»åŒ…å«valid(boolean)å­—æ®µ');\n      }\n\n      if (result.errors && !Array.isArray(result.errors)) {\n        errors.push('validate() è¿”å›å€¼çš„errorså­—æ®µå¿…é¡»æ˜¯æ•°ç»„');\n      }\n\n    } catch (error) {\n      warnings.push(`validate() æ–¹æ³•æµ‹è¯•å¤±è´¥: ${error.message}`);\n    }\n\n    return { valid: errors.length === 0, errors, warnings };\n  }\n\n  /**\n   * ä¸ºå·¥å…·æä¾›é»˜è®¤çš„validateæ–¹æ³•å®ç°\n   * @param {Object} tool - å·¥å…·å¯¹è±¡\n   * @param {Object} parameters - å¾…éªŒè¯å‚æ•°\n   * @returns {Object} éªŒè¯ç»“æœ\n   */\n  static defaultValidate(tool, parameters) {\n    const errors = [];\n\n    try {\n      // è·å–schema\n      const schema = tool.getSchema();\n      \n      // åŸºç¡€ç±»å‹æ£€æŸ¥\n      if (!parameters || typeof parameters !== 'object') {\n        errors.push('å‚æ•°å¿…é¡»æ˜¯å¯¹è±¡ç±»å‹');\n        return { valid: false, errors };\n      }\n\n      // å¿…éœ€å‚æ•°æ£€æŸ¥\n      if (schema.required && Array.isArray(schema.required)) {\n        for (const field of schema.required) {\n          if (!(field in parameters)) {\n            errors.push(`ç¼ºå°‘å¿…éœ€å‚æ•°: ${field}`);\n          }\n        }\n      }\n\n      // åŸºç¡€å­—æ®µç±»å‹æ£€æŸ¥\n      if (schema.properties && typeof schema.properties === 'object') {\n        for (const [field, fieldSchema] of Object.entries(schema.properties)) {\n          if (field in parameters) {\n            const value = parameters[field];\n            const expectedType = fieldSchema.type;\n            \n            if (expectedType && !this.validateType(value, expectedType)) {\n              errors.push(`å‚æ•° ${field} ç±»å‹é”™è¯¯ï¼ŒæœŸæœ› ${expectedType}ï¼Œå®é™… ${typeof value}`);\n            }\n          }\n        }\n      }\n\n    } catch (error) {\n      errors.push(`å‚æ•°éªŒè¯å¤±è´¥: ${error.message}`);\n    }\n\n    return { valid: errors.length === 0, errors };\n  }\n\n  /**\n   * ç±»å‹éªŒè¯è¾…åŠ©æ–¹æ³•\n   * @param {*} value - å¾…éªŒè¯å€¼\n   * @param {string} expectedType - æœŸæœ›ç±»å‹\n   * @returns {boolean} æ˜¯å¦åŒ¹é…\n   */\n  static validateType(value, expectedType) {\n    switch (expectedType) {\n      case 'string':\n        return typeof value === 'string';\n      case 'number':\n        return typeof value === 'number';\n      case 'boolean':\n        return typeof value === 'boolean';\n      case 'object':\n        return typeof value === 'object' && value !== null;\n      case 'array':\n        return Array.isArray(value);\n      default:\n        return true; // æœªçŸ¥ç±»å‹ï¼Œè·³è¿‡éªŒè¯\n    }\n  }\n\n  /**\n   * ç”Ÿæˆå·¥å…·æ¥å£æŠ¥å‘Š\n   * @param {Object} tool - å·¥å…·å¯¹è±¡\n   * @returns {Object} æ¥å£æŠ¥å‘Š\n   */\n  static generateInterfaceReport(tool) {\n    const validation = this.validateTool(tool);\n    const report = {\n      toolName: 'unknown',\n      valid: validation.valid,\n      errors: validation.errors,\n      warnings: validation.warnings,\n      implementedMethods: {\n        required: [],\n        optional: []\n      },\n      metadata: null,\n      schema: null\n    };\n\n    try {\n      // è·å–å·¥å…·åç§°\n      if (tool.getMetadata) {\n        const metadata = tool.getMetadata();\n        report.toolName = metadata.name || 'unknown';\n        report.metadata = metadata;\n      }\n\n      // è·å–schema\n      if (tool.getSchema) {\n        report.schema = tool.getSchema();\n      }\n\n      // æ£€æŸ¥å·²å®ç°çš„æ–¹æ³•\n      for (const methodSpec of TOOL_INTERFACE.required) {\n        if (typeof tool[methodSpec.name] === 'function') {\n          report.implementedMethods.required.push(methodSpec.name);\n        }\n      }\n\n      for (const methodSpec of TOOL_INTERFACE.optional) {\n        if (typeof tool[methodSpec.name] === 'function') {\n          report.implementedMethods.optional.push(methodSpec.name);\n        }\n      }\n\n    } catch (error) {\n      report.warnings.push(`ç”ŸæˆæŠ¥å‘Šæ—¶å‡ºé”™: ${error.message}`);\n    }\n\n    return report;\n  }\n}\n\nmodule.exports = ToolValidator;","const ToolValidator = require('./ToolValidator');\nconst { TOOL_ERROR_CODES, TOOL_RESULT_FORMAT } = require('./ToolInterface');\n\n/**\n * ToolUtils - å·¥å…·å®ç”¨å‡½æ•°é›†åˆ\n * æä¾›å·¥å…·å¼€å‘å’Œä½¿ç”¨çš„è¾…åŠ©å‡½æ•°\n */\nclass ToolUtils {\n  /**\n   * åˆ›å»ºæ ‡å‡†åŒ–çš„æˆåŠŸç»“æœ\n   * @param {*} data - ç»“æœæ•°æ®\n   * @param {Object} options - é€‰é¡¹\n   * @returns {Object} æ ‡å‡†åŒ–ç»“æœ\n   */\n  static createSuccessResult(data, options = {}) {\n    const {\n      tool = 'unknown',\n      executionTime = null,\n      metadata = {}\n    } = options;\n\n    return {\n      success: true,\n      data: data,\n      metadata: {\n        tool: tool,\n        executionTime: executionTime,\n        timestamp: new Date().toISOString(),\n        ...metadata\n      }\n    };\n  }\n\n  /**\n   * åˆ›å»ºæ ‡å‡†åŒ–çš„é”™è¯¯ç»“æœ\n   * @param {string} code - é”™è¯¯ä»£ç \n   * @param {string} message - é”™è¯¯æ¶ˆæ¯\n   * @param {Object} options - é€‰é¡¹\n   * @returns {Object} æ ‡å‡†åŒ–é”™è¯¯\n   */\n  static createErrorResult(code, message, options = {}) {\n    const {\n      tool = 'unknown',\n      details = {},\n      metadata = {}\n    } = options;\n\n    return {\n      success: false,\n      error: {\n        code: code,\n        message: message,\n        details: details\n      },\n      metadata: {\n        tool: tool,\n        timestamp: new Date().toISOString(),\n        ...metadata\n      }\n    };\n  }\n\n  /**\n   * éªŒè¯å·¥å…·ç»“æœæ ¼å¼\n   * @param {Object} result - å·¥å…·ç»“æœ\n   * @returns {Object} éªŒè¯ç»“æœ\n   */\n  static validateResult(result) {\n    const errors = [];\n\n    if (!result || typeof result !== 'object') {\n      errors.push('ç»“æœå¿…é¡»æ˜¯å¯¹è±¡ç±»å‹');\n      return { valid: false, errors };\n    }\n\n    if (typeof result.success !== 'boolean') {\n      errors.push('ç»“æœå¿…é¡»åŒ…å«success(boolean)å­—æ®µ');\n    }\n\n    if (result.success) {\n      // æˆåŠŸç»“æœéªŒè¯\n      if (!('data' in result)) {\n        errors.push('æˆåŠŸç»“æœå¿…é¡»åŒ…å«dataå­—æ®µ');\n      }\n    } else {\n      // é”™è¯¯ç»“æœéªŒè¯\n      if (!result.error || typeof result.error !== 'object') {\n        errors.push('é”™è¯¯ç»“æœå¿…é¡»åŒ…å«error(object)å­—æ®µ');\n      } else {\n        if (!result.error.code || typeof result.error.code !== 'string') {\n          errors.push('é”™è¯¯ç»“æœå¿…é¡»åŒ…å«error.code(string)å­—æ®µ');\n        }\n        if (!result.error.message || typeof result.error.message !== 'string') {\n          errors.push('é”™è¯¯ç»“æœå¿…é¡»åŒ…å«error.message(string)å­—æ®µ');\n        }\n      }\n    }\n\n    return { valid: errors.length === 0, errors };\n  }\n\n  /**\n   * å®‰å…¨åœ°æ‰§è¡Œå·¥å…·æ–¹æ³•\n   * @param {Object} tool - å·¥å…·å®ä¾‹\n   * @param {string} methodName - æ–¹æ³•å\n   * @param {...any} args - æ–¹æ³•å‚æ•°\n   * @returns {Promise<*>} æ‰§è¡Œç»“æœ\n   */\n  static async safeExecute(tool, methodName, ...args) {\n    try {\n      if (!tool || typeof tool[methodName] !== 'function') {\n        throw new Error(`å·¥å…·ä¸å­˜åœ¨æ–¹æ³•: ${methodName}`);\n      }\n\n      const result = await tool[methodName](...args);\n      return result;\n    } catch (error) {\n      throw new Error(`æ–¹æ³•æ‰§è¡Œå¤±è´¥ ${methodName}: ${error.message}`);\n    }\n  }\n\n  /**\n   * å·¥å…·æ€§èƒ½åˆ†æ\n   * @param {Object} tool - å·¥å…·å®ä¾‹\n   * @param {Object} parameters - æµ‹è¯•å‚æ•°\n   * @param {Object} options - é€‰é¡¹\n   * @returns {Promise<Object>} æ€§èƒ½åˆ†æç»“æœ\n   */\n  static async benchmarkTool(tool, parameters = {}, options = {}) {\n    const {\n      iterations = 10,\n      warmup = 3\n    } = options;\n\n    const results = {\n      toolName: 'unknown',\n      iterations: iterations,\n      warmup: warmup,\n      times: [],\n      stats: {}\n    };\n\n    try {\n      // è·å–å·¥å…·åç§°\n      if (tool.getMetadata) {\n        const metadata = tool.getMetadata();\n        results.toolName = metadata.name || 'unknown';\n      }\n\n      // éªŒè¯å·¥å…·æ¥å£\n      const validation = ToolValidator.validateTool(tool);\n      if (!validation.valid) {\n        throw new Error(`å·¥å…·æ¥å£éªŒè¯å¤±è´¥: ${validation.errors.join(', ')}`);\n      }\n\n      // é¢„çƒ­è¿è¡Œ\n      for (let i = 0; i < warmup; i++) {\n        await tool.execute(parameters);\n      }\n\n      // æ€§èƒ½æµ‹è¯•\n      for (let i = 0; i < iterations; i++) {\n        const startTime = process.hrtime.bigint();\n        await tool.execute(parameters);\n        const endTime = process.hrtime.bigint();\n        \n        const executionTime = Number(endTime - startTime) / 1000000; // è½¬æ¢ä¸ºæ¯«ç§’\n        results.times.push(executionTime);\n      }\n\n      // è®¡ç®—ç»Ÿè®¡ä¿¡æ¯\n      results.stats = this.calculateStats(results.times);\n\n    } catch (error) {\n      results.error = error.message;\n    }\n\n    return results;\n  }\n\n  /**\n   * è®¡ç®—ç»Ÿè®¡ä¿¡æ¯\n   * @param {Array<number>} times - æ—¶é—´æ•°ç»„\n   * @returns {Object} ç»Ÿè®¡ä¿¡æ¯\n   */\n  static calculateStats(times) {\n    if (times.length === 0) {\n      return {};\n    }\n\n    const sorted = [...times].sort((a, b) => a - b);\n    const sum = times.reduce((a, b) => a + b, 0);\n    \n    return {\n      count: times.length,\n      min: Math.min(...times),\n      max: Math.max(...times),\n      mean: sum / times.length,\n      median: sorted[Math.floor(sorted.length / 2)],\n      p95: sorted[Math.floor(sorted.length * 0.95)],\n      p99: sorted[Math.floor(sorted.length * 0.99)]\n    };\n  }\n\n  /**\n   * ç”Ÿæˆå·¥å…·æ¨¡æ¿ä»£ç \n   * @param {Object} options - å·¥å…·é€‰é¡¹\n   * @returns {string} å·¥å…·æ¨¡æ¿ä»£ç \n   */\n  static generateToolTemplate(options = {}) {\n    const {\n      toolName = 'ExampleTool',\n      className = 'ExampleTool',\n      description = 'ç¤ºä¾‹å·¥å…·',\n      category = 'utility',\n      author = 'PromptX Developer'\n    } = options;\n\n    return `/**\n * ${className} - ${description}\n * ä½¿ç”¨PromptXé¸­å­ç±»å‹æ¥å£ï¼Œæ— éœ€ç»§æ‰¿ä»»ä½•åŸºç±»\n */\nclass ${className} {\n  getMetadata() {\n    return {\n      name: '${toolName}',\n      description: '${description}',\n      version: '1.0.0',\n      category: '${category}',\n      author: '${author}'\n    };\n  }\n\n  getSchema() {\n    return {\n      type: 'object',\n      properties: {\n        input: {\n          type: 'string',\n          description: 'è¾“å…¥å‚æ•°'\n        }\n      },\n      required: ['input'],\n      additionalProperties: false\n    };\n  }\n\n  async execute(parameters) {\n    const { input } = parameters;\n    \n    try {\n      // TODO: å®ç°å·¥å…·é€»è¾‘\n      const result = \\`å¤„ç†ç»“æœ: \\${input}\\`;\n      \n      return result;\n    } catch (error) {\n      throw new Error(\\`æ‰§è¡Œå¤±è´¥: \\${error.message}\\`);\n    }\n  }\n\n  // å¯é€‰ï¼šè‡ªå®šä¹‰å‚æ•°éªŒè¯\n  validate(parameters) {\n    const errors = [];\n    \n    if (!parameters.input || parameters.input.trim() === '') {\n      errors.push('inputä¸èƒ½ä¸ºç©º');\n    }\n    \n    return { valid: errors.length === 0, errors };\n  }\n\n  // å¯é€‰ï¼šæ¸…ç†èµ„æº\n  cleanup() {\n    // æ¸…ç†é€»è¾‘\n  }\n}\n\nmodule.exports = ${className};\n`;\n  }\n\n  /**\n   * åˆ›å»ºå·¥å…·å¼€å‘æŒ‡å—\n   * @returns {string} å¼€å‘æŒ‡å—\n   */\n  static getDevGuide() {\n    return `\n# PromptX Tool å¼€å‘æŒ‡å—\n\n## é¸­å­ç±»å‹æ¥å£\nPromptXå·¥å…·ä½¿ç”¨é¸­å­ç±»å‹è®¾è®¡ï¼Œæ— éœ€ç»§æ‰¿ä»»ä½•åŸºç±»ã€‚åªéœ€å®ç°ä»¥ä¸‹æ¥å£ï¼š\n\n### å¿…éœ€æ–¹æ³•\n1. \\`getMetadata()\\` - è¿”å›å·¥å…·å…ƒä¿¡æ¯\n2. \\`getSchema()\\` - è¿”å›å‚æ•°JSON Schema\n3. \\`execute(parameters)\\` - æ‰§è¡Œå·¥å…·é€»è¾‘\n\n### å¯é€‰æ–¹æ³•\n1. \\`validate(parameters)\\` - è‡ªå®šä¹‰å‚æ•°éªŒè¯\n2. \\`cleanup()\\` - æ¸…ç†èµ„æº\n3. \\`init(config)\\` - åˆå§‹åŒ–å·¥å…·\n\n## å¼€å‘æ­¥éª¤\n1. ä½¿ç”¨ ToolUtils.generateToolTemplate() ç”Ÿæˆæ¨¡æ¿\n2. å®ç°å¿…éœ€çš„æ¥å£æ–¹æ³•\n3. ä½¿ç”¨ ToolValidator.validateTool() éªŒè¯æ¥å£\n4. ä½¿ç”¨ ToolUtils.benchmarkTool() æ€§èƒ½æµ‹è¯•\n5. æ³¨å†Œåˆ°å·¥å…·æ³¨å†Œè¡¨\n\n## ç¤ºä¾‹ä»£ç \n\\`\\`\\`javascript\n${this.generateToolTemplate()}\n\\`\\`\\`\n\n## æœ€ä½³å®è·µ\n- ä¿æŒexecuteæ–¹æ³•çš„å¹‚ç­‰æ€§\n- æä¾›æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯\n- ä½¿ç”¨åˆé€‚çš„JSON SchemaéªŒè¯\n- å®ç°é€‚å½“çš„èµ„æºæ¸…ç†\n- éµå¾ªç»Ÿä¸€çš„ç»“æœæ ¼å¼\n`;\n  }\n}\n\nmodule.exports = ToolUtils;","/**\n * PromptX Tool Framework\n * ç»Ÿä¸€çš„å·¥å…·æ¡†æ¶å…¥å£æ–‡ä»¶ - ToolSandboxç‰ˆæœ¬\n */\n\nconst ToolSandbox = require('./ToolSandbox');\nconst ToolValidator = require('./ToolValidator');\nconst ToolUtils = require('./ToolUtils');\nconst { TOOL_INTERFACE, TOOL_ERROR_CODES, TOOL_RESULT_FORMAT, EXAMPLE_TOOL } = require('./ToolInterface');\n\n// åˆ›å»ºå…¨å±€å·¥å…·å®ä¾‹\nlet globalSandbox = null;\n\n/**\n * è·å–å…¨å±€å·¥å…·æ²™ç®±\n * @param {string} toolResource - å·¥å…·èµ„æºå¼•ç”¨\n * @returns {ToolSandbox} å·¥å…·æ²™ç®±å®ä¾‹\n */\nfunction getGlobalToolSandbox(toolResource) {\n  // ToolSandboxæ˜¯å·¥å…·ç‰¹å®šçš„ï¼Œä¸ä½¿ç”¨å•ä¾‹\n  return new ToolSandbox(toolResource);\n}\n\n/**\n * åˆå§‹åŒ–å·¥å…·æ¡†æ¶ - ToolSandboxç‰ˆæœ¬\n * @param {Object} options - é…ç½®é€‰é¡¹\n * @returns {Object} åˆå§‹åŒ–ç»“æœ\n */\nfunction initialize(options = {}) {\n  try {\n    return {\n      success: true,\n      message: 'ToolSandboxå·¥å…·æ¡†æ¶åˆå§‹åŒ–æˆåŠŸ',\n      framework: {\n        executor: 'ToolSandbox',\n        version: '2.0.0',\n        features: [\n          'è‡ªåŠ¨ä¾èµ–ç®¡ç†',\n          'æ²™ç®±éš”ç¦»æ‰§è¡Œ', \n          'ä¸‰é˜¶æ®µæ‰§è¡Œæµç¨‹',\n          'pnpmé›†æˆ'\n        ]\n      }\n    };\n  } catch (error) {\n    return {\n      success: false,\n      message: `å·¥å…·æ¡†æ¶åˆå§‹åŒ–å¤±è´¥: ${error.message}`,\n      error: error\n    };\n  }\n}\n\n/**\n * æ‰§è¡Œå·¥å…·çš„ä¾¿æ·æ–¹æ³• - ToolSandboxç‰ˆæœ¬\n * @param {string} toolResource - å·¥å…·èµ„æºå¼•ç”¨ (@tool://tool-name)\n * @param {Object} parameters - å·¥å…·å‚æ•°\n * @param {Object} resourceManager - ResourceManagerå®ä¾‹\n * @returns {Promise<Object>} æ‰§è¡Œç»“æœ\n */\nasync function executeTool(toolResource, parameters = {}, resourceManager = null) {\n  if (!resourceManager) {\n    throw new Error('ResourceManager is required for ToolSandbox execution');\n  }\n  \n  const sandbox = getGlobalToolSandbox(toolResource);\n  sandbox.setResourceManager(resourceManager);\n  \n  try {\n    await sandbox.analyze();\n    await sandbox.prepareDependencies();\n    return await sandbox.execute(parameters);\n  } finally {\n    await sandbox.cleanup();\n  }\n}\n\n/**\n * é‡ç½®å·¥å…·æ¡†æ¶ - ToolSandboxç‰ˆæœ¬\n */\nfunction reset() {\n  // ToolSandboxä¸ä½¿ç”¨å…¨å±€å•ä¾‹ï¼Œæ— éœ€é‡ç½®\n  globalSandbox = null;\n}\n\n/**\n * è·å–å·¥å…·æ¡†æ¶ç»Ÿè®¡ä¿¡æ¯ - ToolSandboxç‰ˆæœ¬\n * @returns {Object} ç»Ÿè®¡ä¿¡æ¯\n */\nfunction getStats() {\n  return {\n    framework: {\n      name: 'PromptX ToolSandbox Framework',\n      version: '2.0.0',\n      executor: 'ToolSandbox',\n      features: [\n        'è‡ªåŠ¨ä¾èµ–ç®¡ç†',\n        'æ²™ç®±éš”ç¦»æ‰§è¡Œ',\n        'ä¸‰é˜¶æ®µæ‰§è¡Œæµç¨‹',\n        'pnpmé›†æˆ',\n        '@tool://åè®®æ”¯æŒ'\n      ]\n    }\n  };\n}\n\nmodule.exports = {\n  // æ ¸å¿ƒç±»\n  ToolSandbox,\n  ToolValidator,\n  ToolUtils,\n  \n  // æ¥å£è§„èŒƒ\n  TOOL_INTERFACE,\n  TOOL_ERROR_CODES,\n  TOOL_RESULT_FORMAT,\n  EXAMPLE_TOOL,\n  \n  // å…¨å±€å®ä¾‹è·å–å™¨\n  getGlobalToolSandbox,\n  \n  // ä¾¿æ·æ–¹æ³•\n  initialize,\n  executeTool,\n  reset,\n  getStats\n};"],"mappings":"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","names":["exports","module","exports","module","exports","module","exports","module","exports","module","exports","module","exports","module","fullPath","exports","module","ToolSandbox","fs","exports","module","TOOL_INTERFACE","TOOL_ERROR_CODES","TOOL_RESULT_FORMAT","EXAMPLE_TOOL","exports","module","TOOL_INTERFACE","TOOL_ERROR_CODES","ToolValidator","exports","module","ToolValidator","TOOL_ERROR_CODES","TOOL_RESULT_FORMAT","ToolUtils"]}